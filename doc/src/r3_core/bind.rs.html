<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `src/r3_core/src/bind.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>bind.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="../../source-script.js"></script><script defer src="../../source-files.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"><style type="text/css">
/* Cover image, something that is definitely relevant to the subject */
.distractor {
    margin: 0 auto;
    max-width: 600px;
}
.distractor > a {
    display: block;
    background-size: cover;
    /* background: ...; — specified by inline style */
    /* padding-bottom: ...; — specified by inline style */
}

/* #![doc(html_logo_url = ...)] */
body.theme-dark .logo-container > img[src$="logo-small.svg"] {
    filter: brightness(0) invert(1) brightness(0.9);
}
body.theme-ayu .logo-container > img[src$="logo-small.svg"] {
    filter: brightness(0) invert(1) brightness(0.85);
}

/* Table of contents */
.toc-header + ul {
    background: rgba(128, 128, 128, 0.1);
    margin: 1em 0; padding: 1em;
    width: 40%;
    min-width: 280px;
    border: 1px solid rgba(128, 128, 128, 0.2);
    font-family: 'Fira Sans'; /* The UI/heading font of rustdoc */
    font-size: 95%;
}
.toc-header + ul::before {
    content: "Contents";
    font-weight: bold;
}
.toc-header + ul ul { margin-bottom: 0; }
.toc-header + ul li { list-style: none; }

/* Poor man's admonition
 *
 * # Usage
 *
 * ## Normal
 *
 *     <div class="admonition-follows"></div>
 *
 *     > **Title:** lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum
 *     > lorem ipsum
 *
 * ## Collapsible
 *
 *     <div class="admonition-follows"></div>
 *
 *     > <details>
 *     > <summary>Title</summary>
 *     >
 *     > lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum
 *     >
 *     > </details>
 */
.admonition-follows + blockquote {
    background: rgba(128, 128, 128, 0.1) !important;
    margin: 1em !important; padding: 1em 1em 0 !important;
    color: inherit !important; overflow: hidden;
}
.admonition-follows + blockquote::after { /* collapsible padding */
    content: ""; display: block; margin-top: 1em;
}

.admonition-follows + blockquote summary {
    cursor: pointer;
    will-change: opacity;
    user-select: none;
    -webkit-user-select: none;
    font-weight: bold;
}
.admonition-follows + blockquote summary:not([open]):not(:hover) {
    opacity: 0.5;
}
.admonition-follows + blockquote summary + * {
    margin-top: 1em;
}

/* Display a warning if some Cargo features are disabled. */
.disabled-feature-warning > p > span:before { content: "Warning:"; font-weight: bold; }
.disabled-feature-warning > p > span:after { content: " This documentation was built without a "; }
.disabled-feature-warning > p > code:before { content: "--all-features"; }
.disabled-feature-warning > p:after { content: " build option. Some items might be missing."; }

/* Center an inline image
 *
 * # Usage
 *
 *    <span class="center">![kernel-traits]</span>
 *
 *    [kernel-traits]: data:image/svg+xml;base64,< super long base64 data >
 *
 * The image wouldn't render if `![kernel-traits]` were wrapped with `<center>`
 * because the Markdown processor doesn't do Markdown processing inside a block
 * element. On the other hand, it thinks `<span>` is an inline element (by
 * default), so markups inside `<span>` are processed.
 *
 * For diagrams processed by `::svgbobdoc`, just use `<center>`.
 */
span.center {
    display: block;
    text-align: center;
}

/* Add margins to SvgBob images */
span.center img, center img {
    border: 10px solid white;
    background: white;
}

/* Auto-invert SvgBob images in a dark theme */
body.theme-dark span.center img, body.theme-dark center img {
    filter: invert(88%);
}

body.theme-ayu span.center img, body.theme-ayu center img {
    filter: invert(89%) sepia(90%) hue-rotate(180deg);
}

/* FIXME: rustdoc's intra-doc processor generates a warning when it encounters a
   bracketed text with an unknown link target. This misfires for CSS attribute
   selectors. Make rustdoc happy by defining a fake link target. I'm not sure if
   it's worth reporting.

[open]: #dummy

*/
</style>
<script type="application/javascript">
<!--
// Monitors the current rustdoc theme and adds `.theme-NAME` to `<body>`
function initThemeMonitor() {
    if (typeof switchTheme !== 'function' ||
        typeof themeStyle !== 'object' ||
        typeof document.body.classList === 'undefined')
    {
        // Something is wrong, don't do anything
        return;
    }

    var currentClassName = null;
    function onApplyTheme(name) {
        if (currentClassName != null) {
            document.body.classList.remove(currentClassName);
        }
        currentClassName = "theme-" + name;
        document.body.classList.add(currentClassName);
    }

    var match = themeStyle.href.match(/\/([a-z]+)(-[-a-zA-Z0-9.]*)?\.css$/);
    var currentStyle = (match && match[1]) || "light";
    onApplyTheme(currentStyle);

    // Intercept calls to `switchTheme`
    var originalSwitchTheme = switchTheme;
    switchTheme = function (_0, _1, newTheme) {
        onApplyTheme(newTheme);
        originalSwitchTheme.apply(this, arguments);
    };
}

if (document.readyState === 'interactive' || document.readyState === 'complete') {
    initThemeMonitor();
} else {
    document.addEventListener('DOMContentLoaded', initThemeMonitor);
}
-->
</script>
</head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../r3_core/index.html"><div class="logo-container"><img src="https://r3-os.github.io/r3/logo-small.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../r3_core/index.html"><div class="logo-container">
                    <img src="https://r3-os.github.io/r3/logo-small.svg" alt="logo"></div></a></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../r3_core/index.html">
                        <img src="https://r3-os.github.io/r3/logo-small.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">1</span>
<span id="2">2</span>
<span id="3">3</span>
<span id="4">4</span>
<span id="5">5</span>
<span id="6">6</span>
<span id="7">7</span>
<span id="8">8</span>
<span id="9">9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
<span id="60">60</span>
<span id="61">61</span>
<span id="62">62</span>
<span id="63">63</span>
<span id="64">64</span>
<span id="65">65</span>
<span id="66">66</span>
<span id="67">67</span>
<span id="68">68</span>
<span id="69">69</span>
<span id="70">70</span>
<span id="71">71</span>
<span id="72">72</span>
<span id="73">73</span>
<span id="74">74</span>
<span id="75">75</span>
<span id="76">76</span>
<span id="77">77</span>
<span id="78">78</span>
<span id="79">79</span>
<span id="80">80</span>
<span id="81">81</span>
<span id="82">82</span>
<span id="83">83</span>
<span id="84">84</span>
<span id="85">85</span>
<span id="86">86</span>
<span id="87">87</span>
<span id="88">88</span>
<span id="89">89</span>
<span id="90">90</span>
<span id="91">91</span>
<span id="92">92</span>
<span id="93">93</span>
<span id="94">94</span>
<span id="95">95</span>
<span id="96">96</span>
<span id="97">97</span>
<span id="98">98</span>
<span id="99">99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
<span id="749">749</span>
<span id="750">750</span>
<span id="751">751</span>
<span id="752">752</span>
<span id="753">753</span>
<span id="754">754</span>
<span id="755">755</span>
<span id="756">756</span>
<span id="757">757</span>
<span id="758">758</span>
<span id="759">759</span>
<span id="760">760</span>
<span id="761">761</span>
<span id="762">762</span>
<span id="763">763</span>
<span id="764">764</span>
<span id="765">765</span>
<span id="766">766</span>
<span id="767">767</span>
<span id="768">768</span>
<span id="769">769</span>
<span id="770">770</span>
<span id="771">771</span>
<span id="772">772</span>
<span id="773">773</span>
<span id="774">774</span>
<span id="775">775</span>
<span id="776">776</span>
<span id="777">777</span>
<span id="778">778</span>
<span id="779">779</span>
<span id="780">780</span>
<span id="781">781</span>
<span id="782">782</span>
<span id="783">783</span>
<span id="784">784</span>
<span id="785">785</span>
<span id="786">786</span>
<span id="787">787</span>
<span id="788">788</span>
<span id="789">789</span>
<span id="790">790</span>
<span id="791">791</span>
<span id="792">792</span>
<span id="793">793</span>
<span id="794">794</span>
<span id="795">795</span>
<span id="796">796</span>
<span id="797">797</span>
<span id="798">798</span>
<span id="799">799</span>
<span id="800">800</span>
<span id="801">801</span>
<span id="802">802</span>
<span id="803">803</span>
<span id="804">804</span>
<span id="805">805</span>
<span id="806">806</span>
<span id="807">807</span>
<span id="808">808</span>
<span id="809">809</span>
<span id="810">810</span>
<span id="811">811</span>
<span id="812">812</span>
<span id="813">813</span>
<span id="814">814</span>
<span id="815">815</span>
<span id="816">816</span>
<span id="817">817</span>
<span id="818">818</span>
<span id="819">819</span>
<span id="820">820</span>
<span id="821">821</span>
<span id="822">822</span>
<span id="823">823</span>
<span id="824">824</span>
<span id="825">825</span>
<span id="826">826</span>
<span id="827">827</span>
<span id="828">828</span>
<span id="829">829</span>
<span id="830">830</span>
<span id="831">831</span>
<span id="832">832</span>
<span id="833">833</span>
<span id="834">834</span>
<span id="835">835</span>
<span id="836">836</span>
<span id="837">837</span>
<span id="838">838</span>
<span id="839">839</span>
<span id="840">840</span>
<span id="841">841</span>
<span id="842">842</span>
<span id="843">843</span>
<span id="844">844</span>
<span id="845">845</span>
<span id="846">846</span>
<span id="847">847</span>
<span id="848">848</span>
<span id="849">849</span>
<span id="850">850</span>
<span id="851">851</span>
<span id="852">852</span>
<span id="853">853</span>
<span id="854">854</span>
<span id="855">855</span>
<span id="856">856</span>
<span id="857">857</span>
<span id="858">858</span>
<span id="859">859</span>
<span id="860">860</span>
<span id="861">861</span>
<span id="862">862</span>
<span id="863">863</span>
<span id="864">864</span>
<span id="865">865</span>
<span id="866">866</span>
<span id="867">867</span>
<span id="868">868</span>
<span id="869">869</span>
<span id="870">870</span>
<span id="871">871</span>
<span id="872">872</span>
<span id="873">873</span>
<span id="874">874</span>
<span id="875">875</span>
<span id="876">876</span>
<span id="877">877</span>
<span id="878">878</span>
<span id="879">879</span>
<span id="880">880</span>
<span id="881">881</span>
<span id="882">882</span>
<span id="883">883</span>
<span id="884">884</span>
<span id="885">885</span>
<span id="886">886</span>
<span id="887">887</span>
<span id="888">888</span>
<span id="889">889</span>
<span id="890">890</span>
<span id="891">891</span>
<span id="892">892</span>
<span id="893">893</span>
<span id="894">894</span>
<span id="895">895</span>
<span id="896">896</span>
<span id="897">897</span>
<span id="898">898</span>
<span id="899">899</span>
<span id="900">900</span>
<span id="901">901</span>
<span id="902">902</span>
<span id="903">903</span>
<span id="904">904</span>
<span id="905">905</span>
<span id="906">906</span>
<span id="907">907</span>
<span id="908">908</span>
<span id="909">909</span>
<span id="910">910</span>
<span id="911">911</span>
<span id="912">912</span>
<span id="913">913</span>
<span id="914">914</span>
<span id="915">915</span>
<span id="916">916</span>
<span id="917">917</span>
<span id="918">918</span>
<span id="919">919</span>
<span id="920">920</span>
<span id="921">921</span>
<span id="922">922</span>
<span id="923">923</span>
<span id="924">924</span>
<span id="925">925</span>
<span id="926">926</span>
<span id="927">927</span>
<span id="928">928</span>
<span id="929">929</span>
<span id="930">930</span>
<span id="931">931</span>
<span id="932">932</span>
<span id="933">933</span>
<span id="934">934</span>
<span id="935">935</span>
<span id="936">936</span>
<span id="937">937</span>
<span id="938">938</span>
<span id="939">939</span>
<span id="940">940</span>
<span id="941">941</span>
<span id="942">942</span>
<span id="943">943</span>
<span id="944">944</span>
<span id="945">945</span>
<span id="946">946</span>
<span id="947">947</span>
<span id="948">948</span>
<span id="949">949</span>
<span id="950">950</span>
<span id="951">951</span>
<span id="952">952</span>
<span id="953">953</span>
<span id="954">954</span>
<span id="955">955</span>
<span id="956">956</span>
<span id="957">957</span>
<span id="958">958</span>
<span id="959">959</span>
<span id="960">960</span>
<span id="961">961</span>
<span id="962">962</span>
<span id="963">963</span>
<span id="964">964</span>
<span id="965">965</span>
<span id="966">966</span>
<span id="967">967</span>
<span id="968">968</span>
<span id="969">969</span>
<span id="970">970</span>
<span id="971">971</span>
<span id="972">972</span>
<span id="973">973</span>
<span id="974">974</span>
<span id="975">975</span>
<span id="976">976</span>
<span id="977">977</span>
<span id="978">978</span>
<span id="979">979</span>
<span id="980">980</span>
<span id="981">981</span>
<span id="982">982</span>
<span id="983">983</span>
<span id="984">984</span>
<span id="985">985</span>
<span id="986">986</span>
<span id="987">987</span>
<span id="988">988</span>
<span id="989">989</span>
<span id="990">990</span>
<span id="991">991</span>
<span id="992">992</span>
<span id="993">993</span>
<span id="994">994</span>
<span id="995">995</span>
<span id="996">996</span>
<span id="997">997</span>
<span id="998">998</span>
<span id="999">999</span>
<span id="1000">1000</span>
<span id="1001">1001</span>
<span id="1002">1002</span>
<span id="1003">1003</span>
<span id="1004">1004</span>
<span id="1005">1005</span>
<span id="1006">1006</span>
<span id="1007">1007</span>
<span id="1008">1008</span>
<span id="1009">1009</span>
<span id="1010">1010</span>
<span id="1011">1011</span>
<span id="1012">1012</span>
<span id="1013">1013</span>
<span id="1014">1014</span>
<span id="1015">1015</span>
<span id="1016">1016</span>
<span id="1017">1017</span>
<span id="1018">1018</span>
<span id="1019">1019</span>
<span id="1020">1020</span>
<span id="1021">1021</span>
<span id="1022">1022</span>
<span id="1023">1023</span>
<span id="1024">1024</span>
<span id="1025">1025</span>
<span id="1026">1026</span>
<span id="1027">1027</span>
<span id="1028">1028</span>
<span id="1029">1029</span>
<span id="1030">1030</span>
<span id="1031">1031</span>
<span id="1032">1032</span>
<span id="1033">1033</span>
<span id="1034">1034</span>
<span id="1035">1035</span>
<span id="1036">1036</span>
<span id="1037">1037</span>
<span id="1038">1038</span>
<span id="1039">1039</span>
<span id="1040">1040</span>
<span id="1041">1041</span>
<span id="1042">1042</span>
<span id="1043">1043</span>
<span id="1044">1044</span>
<span id="1045">1045</span>
<span id="1046">1046</span>
<span id="1047">1047</span>
<span id="1048">1048</span>
<span id="1049">1049</span>
<span id="1050">1050</span>
<span id="1051">1051</span>
<span id="1052">1052</span>
<span id="1053">1053</span>
<span id="1054">1054</span>
<span id="1055">1055</span>
<span id="1056">1056</span>
<span id="1057">1057</span>
<span id="1058">1058</span>
<span id="1059">1059</span>
<span id="1060">1060</span>
<span id="1061">1061</span>
<span id="1062">1062</span>
<span id="1063">1063</span>
<span id="1064">1064</span>
<span id="1065">1065</span>
<span id="1066">1066</span>
<span id="1067">1067</span>
<span id="1068">1068</span>
<span id="1069">1069</span>
<span id="1070">1070</span>
<span id="1071">1071</span>
<span id="1072">1072</span>
<span id="1073">1073</span>
<span id="1074">1074</span>
<span id="1075">1075</span>
<span id="1076">1076</span>
<span id="1077">1077</span>
<span id="1078">1078</span>
<span id="1079">1079</span>
<span id="1080">1080</span>
<span id="1081">1081</span>
<span id="1082">1082</span>
<span id="1083">1083</span>
<span id="1084">1084</span>
<span id="1085">1085</span>
<span id="1086">1086</span>
<span id="1087">1087</span>
<span id="1088">1088</span>
<span id="1089">1089</span>
<span id="1090">1090</span>
<span id="1091">1091</span>
<span id="1092">1092</span>
<span id="1093">1093</span>
<span id="1094">1094</span>
<span id="1095">1095</span>
<span id="1096">1096</span>
<span id="1097">1097</span>
<span id="1098">1098</span>
<span id="1099">1099</span>
<span id="1100">1100</span>
<span id="1101">1101</span>
<span id="1102">1102</span>
<span id="1103">1103</span>
<span id="1104">1104</span>
<span id="1105">1105</span>
<span id="1106">1106</span>
<span id="1107">1107</span>
<span id="1108">1108</span>
<span id="1109">1109</span>
<span id="1110">1110</span>
<span id="1111">1111</span>
<span id="1112">1112</span>
<span id="1113">1113</span>
<span id="1114">1114</span>
<span id="1115">1115</span>
<span id="1116">1116</span>
<span id="1117">1117</span>
<span id="1118">1118</span>
<span id="1119">1119</span>
<span id="1120">1120</span>
<span id="1121">1121</span>
<span id="1122">1122</span>
<span id="1123">1123</span>
<span id="1124">1124</span>
<span id="1125">1125</span>
<span id="1126">1126</span>
<span id="1127">1127</span>
<span id="1128">1128</span>
<span id="1129">1129</span>
<span id="1130">1130</span>
<span id="1131">1131</span>
<span id="1132">1132</span>
<span id="1133">1133</span>
<span id="1134">1134</span>
<span id="1135">1135</span>
<span id="1136">1136</span>
<span id="1137">1137</span>
<span id="1138">1138</span>
<span id="1139">1139</span>
<span id="1140">1140</span>
<span id="1141">1141</span>
<span id="1142">1142</span>
<span id="1143">1143</span>
<span id="1144">1144</span>
<span id="1145">1145</span>
<span id="1146">1146</span>
<span id="1147">1147</span>
<span id="1148">1148</span>
<span id="1149">1149</span>
<span id="1150">1150</span>
<span id="1151">1151</span>
<span id="1152">1152</span>
<span id="1153">1153</span>
<span id="1154">1154</span>
<span id="1155">1155</span>
<span id="1156">1156</span>
<span id="1157">1157</span>
<span id="1158">1158</span>
<span id="1159">1159</span>
<span id="1160">1160</span>
<span id="1161">1161</span>
<span id="1162">1162</span>
<span id="1163">1163</span>
<span id="1164">1164</span>
<span id="1165">1165</span>
<span id="1166">1166</span>
<span id="1167">1167</span>
<span id="1168">1168</span>
<span id="1169">1169</span>
<span id="1170">1170</span>
<span id="1171">1171</span>
<span id="1172">1172</span>
<span id="1173">1173</span>
<span id="1174">1174</span>
<span id="1175">1175</span>
<span id="1176">1176</span>
<span id="1177">1177</span>
<span id="1178">1178</span>
<span id="1179">1179</span>
<span id="1180">1180</span>
<span id="1181">1181</span>
<span id="1182">1182</span>
<span id="1183">1183</span>
<span id="1184">1184</span>
<span id="1185">1185</span>
<span id="1186">1186</span>
<span id="1187">1187</span>
<span id="1188">1188</span>
<span id="1189">1189</span>
<span id="1190">1190</span>
<span id="1191">1191</span>
<span id="1192">1192</span>
<span id="1193">1193</span>
<span id="1194">1194</span>
<span id="1195">1195</span>
<span id="1196">1196</span>
<span id="1197">1197</span>
<span id="1198">1198</span>
<span id="1199">1199</span>
<span id="1200">1200</span>
<span id="1201">1201</span>
<span id="1202">1202</span>
<span id="1203">1203</span>
<span id="1204">1204</span>
<span id="1205">1205</span>
<span id="1206">1206</span>
<span id="1207">1207</span>
<span id="1208">1208</span>
<span id="1209">1209</span>
<span id="1210">1210</span>
<span id="1211">1211</span>
<span id="1212">1212</span>
<span id="1213">1213</span>
<span id="1214">1214</span>
<span id="1215">1215</span>
<span id="1216">1216</span>
<span id="1217">1217</span>
<span id="1218">1218</span>
<span id="1219">1219</span>
<span id="1220">1220</span>
<span id="1221">1221</span>
<span id="1222">1222</span>
<span id="1223">1223</span>
<span id="1224">1224</span>
<span id="1225">1225</span>
<span id="1226">1226</span>
<span id="1227">1227</span>
<span id="1228">1228</span>
<span id="1229">1229</span>
<span id="1230">1230</span>
<span id="1231">1231</span>
<span id="1232">1232</span>
<span id="1233">1233</span>
<span id="1234">1234</span>
<span id="1235">1235</span>
<span id="1236">1236</span>
<span id="1237">1237</span>
<span id="1238">1238</span>
<span id="1239">1239</span>
<span id="1240">1240</span>
<span id="1241">1241</span>
<span id="1242">1242</span>
<span id="1243">1243</span>
<span id="1244">1244</span>
<span id="1245">1245</span>
<span id="1246">1246</span>
<span id="1247">1247</span>
<span id="1248">1248</span>
<span id="1249">1249</span>
<span id="1250">1250</span>
<span id="1251">1251</span>
<span id="1252">1252</span>
<span id="1253">1253</span>
<span id="1254">1254</span>
<span id="1255">1255</span>
<span id="1256">1256</span>
<span id="1257">1257</span>
<span id="1258">1258</span>
<span id="1259">1259</span>
<span id="1260">1260</span>
<span id="1261">1261</span>
<span id="1262">1262</span>
<span id="1263">1263</span>
<span id="1264">1264</span>
<span id="1265">1265</span>
<span id="1266">1266</span>
<span id="1267">1267</span>
<span id="1268">1268</span>
<span id="1269">1269</span>
<span id="1270">1270</span>
<span id="1271">1271</span>
<span id="1272">1272</span>
<span id="1273">1273</span>
<span id="1274">1274</span>
<span id="1275">1275</span>
<span id="1276">1276</span>
<span id="1277">1277</span>
<span id="1278">1278</span>
<span id="1279">1279</span>
<span id="1280">1280</span>
<span id="1281">1281</span>
<span id="1282">1282</span>
<span id="1283">1283</span>
<span id="1284">1284</span>
<span id="1285">1285</span>
<span id="1286">1286</span>
<span id="1287">1287</span>
<span id="1288">1288</span>
<span id="1289">1289</span>
<span id="1290">1290</span>
<span id="1291">1291</span>
<span id="1292">1292</span>
<span id="1293">1293</span>
<span id="1294">1294</span>
<span id="1295">1295</span>
<span id="1296">1296</span>
<span id="1297">1297</span>
<span id="1298">1298</span>
<span id="1299">1299</span>
<span id="1300">1300</span>
<span id="1301">1301</span>
<span id="1302">1302</span>
<span id="1303">1303</span>
<span id="1304">1304</span>
<span id="1305">1305</span>
<span id="1306">1306</span>
<span id="1307">1307</span>
<span id="1308">1308</span>
<span id="1309">1309</span>
<span id="1310">1310</span>
<span id="1311">1311</span>
<span id="1312">1312</span>
<span id="1313">1313</span>
<span id="1314">1314</span>
<span id="1315">1315</span>
<span id="1316">1316</span>
<span id="1317">1317</span>
<span id="1318">1318</span>
<span id="1319">1319</span>
<span id="1320">1320</span>
<span id="1321">1321</span>
<span id="1322">1322</span>
<span id="1323">1323</span>
<span id="1324">1324</span>
<span id="1325">1325</span>
<span id="1326">1326</span>
<span id="1327">1327</span>
<span id="1328">1328</span>
<span id="1329">1329</span>
<span id="1330">1330</span>
<span id="1331">1331</span>
<span id="1332">1332</span>
<span id="1333">1333</span>
<span id="1334">1334</span>
<span id="1335">1335</span>
<span id="1336">1336</span>
<span id="1337">1337</span>
<span id="1338">1338</span>
<span id="1339">1339</span>
<span id="1340">1340</span>
<span id="1341">1341</span>
<span id="1342">1342</span>
<span id="1343">1343</span>
<span id="1344">1344</span>
<span id="1345">1345</span>
<span id="1346">1346</span>
<span id="1347">1347</span>
<span id="1348">1348</span>
<span id="1349">1349</span>
<span id="1350">1350</span>
<span id="1351">1351</span>
<span id="1352">1352</span>
<span id="1353">1353</span>
<span id="1354">1354</span>
<span id="1355">1355</span>
<span id="1356">1356</span>
<span id="1357">1357</span>
<span id="1358">1358</span>
<span id="1359">1359</span>
<span id="1360">1360</span>
<span id="1361">1361</span>
<span id="1362">1362</span>
<span id="1363">1363</span>
<span id="1364">1364</span>
<span id="1365">1365</span>
<span id="1366">1366</span>
<span id="1367">1367</span>
<span id="1368">1368</span>
<span id="1369">1369</span>
<span id="1370">1370</span>
<span id="1371">1371</span>
<span id="1372">1372</span>
<span id="1373">1373</span>
<span id="1374">1374</span>
<span id="1375">1375</span>
<span id="1376">1376</span>
<span id="1377">1377</span>
<span id="1378">1378</span>
<span id="1379">1379</span>
<span id="1380">1380</span>
<span id="1381">1381</span>
<span id="1382">1382</span>
<span id="1383">1383</span>
<span id="1384">1384</span>
<span id="1385">1385</span>
<span id="1386">1386</span>
<span id="1387">1387</span>
<span id="1388">1388</span>
<span id="1389">1389</span>
<span id="1390">1390</span>
<span id="1391">1391</span>
<span id="1392">1392</span>
<span id="1393">1393</span>
<span id="1394">1394</span>
<span id="1395">1395</span>
<span id="1396">1396</span>
<span id="1397">1397</span>
<span id="1398">1398</span>
<span id="1399">1399</span>
<span id="1400">1400</span>
<span id="1401">1401</span>
<span id="1402">1402</span>
<span id="1403">1403</span>
<span id="1404">1404</span>
<span id="1405">1405</span>
<span id="1406">1406</span>
<span id="1407">1407</span>
<span id="1408">1408</span>
<span id="1409">1409</span>
<span id="1410">1410</span>
<span id="1411">1411</span>
<span id="1412">1412</span>
<span id="1413">1413</span>
<span id="1414">1414</span>
<span id="1415">1415</span>
<span id="1416">1416</span>
<span id="1417">1417</span>
<span id="1418">1418</span>
<span id="1419">1419</span>
<span id="1420">1420</span>
<span id="1421">1421</span>
<span id="1422">1422</span>
<span id="1423">1423</span>
<span id="1424">1424</span>
<span id="1425">1425</span>
<span id="1426">1426</span>
<span id="1427">1427</span>
<span id="1428">1428</span>
<span id="1429">1429</span>
<span id="1430">1430</span>
<span id="1431">1431</span>
<span id="1432">1432</span>
<span id="1433">1433</span>
<span id="1434">1434</span>
<span id="1435">1435</span>
<span id="1436">1436</span>
<span id="1437">1437</span>
<span id="1438">1438</span>
<span id="1439">1439</span>
<span id="1440">1440</span>
<span id="1441">1441</span>
<span id="1442">1442</span>
<span id="1443">1443</span>
<span id="1444">1444</span>
<span id="1445">1445</span>
<span id="1446">1446</span>
<span id="1447">1447</span>
<span id="1448">1448</span>
<span id="1449">1449</span>
<span id="1450">1450</span>
<span id="1451">1451</span>
<span id="1452">1452</span>
<span id="1453">1453</span>
<span id="1454">1454</span>
<span id="1455">1455</span>
<span id="1456">1456</span>
<span id="1457">1457</span>
<span id="1458">1458</span>
<span id="1459">1459</span>
<span id="1460">1460</span>
<span id="1461">1461</span>
<span id="1462">1462</span>
<span id="1463">1463</span>
<span id="1464">1464</span>
<span id="1465">1465</span>
<span id="1466">1466</span>
<span id="1467">1467</span>
<span id="1468">1468</span>
<span id="1469">1469</span>
<span id="1470">1470</span>
<span id="1471">1471</span>
<span id="1472">1472</span>
<span id="1473">1473</span>
<span id="1474">1474</span>
<span id="1475">1475</span>
<span id="1476">1476</span>
<span id="1477">1477</span>
<span id="1478">1478</span>
<span id="1479">1479</span>
<span id="1480">1480</span>
<span id="1481">1481</span>
<span id="1482">1482</span>
<span id="1483">1483</span>
<span id="1484">1484</span>
<span id="1485">1485</span>
<span id="1486">1486</span>
<span id="1487">1487</span>
<span id="1488">1488</span>
<span id="1489">1489</span>
<span id="1490">1490</span>
<span id="1491">1491</span>
<span id="1492">1492</span>
<span id="1493">1493</span>
<span id="1494">1494</span>
<span id="1495">1495</span>
<span id="1496">1496</span>
<span id="1497">1497</span>
<span id="1498">1498</span>
<span id="1499">1499</span>
<span id="1500">1500</span>
<span id="1501">1501</span>
<span id="1502">1502</span>
<span id="1503">1503</span>
<span id="1504">1504</span>
<span id="1505">1505</span>
<span id="1506">1506</span>
<span id="1507">1507</span>
<span id="1508">1508</span>
<span id="1509">1509</span>
<span id="1510">1510</span>
<span id="1511">1511</span>
<span id="1512">1512</span>
<span id="1513">1513</span>
<span id="1514">1514</span>
<span id="1515">1515</span>
<span id="1516">1516</span>
<span id="1517">1517</span>
<span id="1518">1518</span>
<span id="1519">1519</span>
<span id="1520">1520</span>
<span id="1521">1521</span>
<span id="1522">1522</span>
<span id="1523">1523</span>
<span id="1524">1524</span>
<span id="1525">1525</span>
<span id="1526">1526</span>
<span id="1527">1527</span>
<span id="1528">1528</span>
<span id="1529">1529</span>
<span id="1530">1530</span>
<span id="1531">1531</span>
<span id="1532">1532</span>
<span id="1533">1533</span>
<span id="1534">1534</span>
<span id="1535">1535</span>
<span id="1536">1536</span>
<span id="1537">1537</span>
<span id="1538">1538</span>
<span id="1539">1539</span>
<span id="1540">1540</span>
<span id="1541">1541</span>
<span id="1542">1542</span>
<span id="1543">1543</span>
<span id="1544">1544</span>
<span id="1545">1545</span>
<span id="1546">1546</span>
<span id="1547">1547</span>
<span id="1548">1548</span>
<span id="1549">1549</span>
<span id="1550">1550</span>
<span id="1551">1551</span>
<span id="1552">1552</span>
<span id="1553">1553</span>
<span id="1554">1554</span>
<span id="1555">1555</span>
<span id="1556">1556</span>
<span id="1557">1557</span>
<span id="1558">1558</span>
<span id="1559">1559</span>
<span id="1560">1560</span>
<span id="1561">1561</span>
<span id="1562">1562</span>
<span id="1563">1563</span>
<span id="1564">1564</span>
<span id="1565">1565</span>
<span id="1566">1566</span>
<span id="1567">1567</span>
<span id="1568">1568</span>
<span id="1569">1569</span>
<span id="1570">1570</span>
<span id="1571">1571</span>
<span id="1572">1572</span>
<span id="1573">1573</span>
<span id="1574">1574</span>
<span id="1575">1575</span>
<span id="1576">1576</span>
<span id="1577">1577</span>
<span id="1578">1578</span>
<span id="1579">1579</span>
<span id="1580">1580</span>
<span id="1581">1581</span>
<span id="1582">1582</span>
<span id="1583">1583</span>
<span id="1584">1584</span>
<span id="1585">1585</span>
<span id="1586">1586</span>
<span id="1587">1587</span>
<span id="1588">1588</span>
<span id="1589">1589</span>
<span id="1590">1590</span>
<span id="1591">1591</span>
<span id="1592">1592</span>
<span id="1593">1593</span>
<span id="1594">1594</span>
<span id="1595">1595</span>
<span id="1596">1596</span>
<span id="1597">1597</span>
<span id="1598">1598</span>
<span id="1599">1599</span>
<span id="1600">1600</span>
<span id="1601">1601</span>
<span id="1602">1602</span>
<span id="1603">1603</span>
<span id="1604">1604</span>
<span id="1605">1605</span>
<span id="1606">1606</span>
<span id="1607">1607</span>
<span id="1608">1608</span>
<span id="1609">1609</span>
<span id="1610">1610</span>
<span id="1611">1611</span>
<span id="1612">1612</span>
<span id="1613">1613</span>
<span id="1614">1614</span>
<span id="1615">1615</span>
<span id="1616">1616</span>
<span id="1617">1617</span>
<span id="1618">1618</span>
<span id="1619">1619</span>
<span id="1620">1620</span>
<span id="1621">1621</span>
<span id="1622">1622</span>
<span id="1623">1623</span>
<span id="1624">1624</span>
<span id="1625">1625</span>
<span id="1626">1626</span>
<span id="1627">1627</span>
<span id="1628">1628</span>
<span id="1629">1629</span>
<span id="1630">1630</span>
<span id="1631">1631</span>
<span id="1632">1632</span>
<span id="1633">1633</span>
<span id="1634">1634</span>
<span id="1635">1635</span>
<span id="1636">1636</span>
<span id="1637">1637</span>
<span id="1638">1638</span>
<span id="1639">1639</span>
<span id="1640">1640</span>
<span id="1641">1641</span>
<span id="1642">1642</span>
<span id="1643">1643</span>
<span id="1644">1644</span>
<span id="1645">1645</span>
<span id="1646">1646</span>
<span id="1647">1647</span>
<span id="1648">1648</span>
<span id="1649">1649</span>
<span id="1650">1650</span>
<span id="1651">1651</span>
<span id="1652">1652</span>
<span id="1653">1653</span>
<span id="1654">1654</span>
<span id="1655">1655</span>
<span id="1656">1656</span>
<span id="1657">1657</span>
<span id="1658">1658</span>
<span id="1659">1659</span>
<span id="1660">1660</span>
<span id="1661">1661</span>
<span id="1662">1662</span>
<span id="1663">1663</span>
<span id="1664">1664</span>
<span id="1665">1665</span>
<span id="1666">1666</span>
<span id="1667">1667</span>
<span id="1668">1668</span>
<span id="1669">1669</span>
<span id="1670">1670</span>
<span id="1671">1671</span>
<span id="1672">1672</span>
<span id="1673">1673</span>
<span id="1674">1674</span>
<span id="1675">1675</span>
<span id="1676">1676</span>
<span id="1677">1677</span>
<span id="1678">1678</span>
<span id="1679">1679</span>
<span id="1680">1680</span>
<span id="1681">1681</span>
<span id="1682">1682</span>
<span id="1683">1683</span>
<span id="1684">1684</span>
<span id="1685">1685</span>
<span id="1686">1686</span>
<span id="1687">1687</span>
<span id="1688">1688</span>
<span id="1689">1689</span>
<span id="1690">1690</span>
<span id="1691">1691</span>
<span id="1692">1692</span>
<span id="1693">1693</span>
<span id="1694">1694</span>
<span id="1695">1695</span>
<span id="1696">1696</span>
<span id="1697">1697</span>
<span id="1698">1698</span>
<span id="1699">1699</span>
<span id="1700">1700</span>
<span id="1701">1701</span>
<span id="1702">1702</span>
<span id="1703">1703</span>
<span id="1704">1704</span>
<span id="1705">1705</span>
<span id="1706">1706</span>
<span id="1707">1707</span>
<span id="1708">1708</span>
<span id="1709">1709</span>
<span id="1710">1710</span>
<span id="1711">1711</span>
<span id="1712">1712</span>
<span id="1713">1713</span>
<span id="1714">1714</span>
<span id="1715">1715</span>
<span id="1716">1716</span>
<span id="1717">1717</span>
<span id="1718">1718</span>
<span id="1719">1719</span>
<span id="1720">1720</span>
<span id="1721">1721</span>
<span id="1722">1722</span>
<span id="1723">1723</span>
<span id="1724">1724</span>
<span id="1725">1725</span>
<span id="1726">1726</span>
<span id="1727">1727</span>
<span id="1728">1728</span>
<span id="1729">1729</span>
<span id="1730">1730</span>
<span id="1731">1731</span>
<span id="1732">1732</span>
<span id="1733">1733</span>
<span id="1734">1734</span>
<span id="1735">1735</span>
<span id="1736">1736</span>
<span id="1737">1737</span>
<span id="1738">1738</span>
<span id="1739">1739</span>
<span id="1740">1740</span>
<span id="1741">1741</span>
<span id="1742">1742</span>
<span id="1743">1743</span>
<span id="1744">1744</span>
<span id="1745">1745</span>
<span id="1746">1746</span>
<span id="1747">1747</span>
<span id="1748">1748</span>
<span id="1749">1749</span>
<span id="1750">1750</span>
<span id="1751">1751</span>
<span id="1752">1752</span>
<span id="1753">1753</span>
<span id="1754">1754</span>
<span id="1755">1755</span>
<span id="1756">1756</span>
<span id="1757">1757</span>
<span id="1758">1758</span>
<span id="1759">1759</span>
<span id="1760">1760</span>
<span id="1761">1761</span>
<span id="1762">1762</span>
<span id="1763">1763</span>
<span id="1764">1764</span>
<span id="1765">1765</span>
<span id="1766">1766</span>
<span id="1767">1767</span>
<span id="1768">1768</span>
<span id="1769">1769</span>
<span id="1770">1770</span>
<span id="1771">1771</span>
<span id="1772">1772</span>
<span id="1773">1773</span>
<span id="1774">1774</span>
<span id="1775">1775</span>
<span id="1776">1776</span>
<span id="1777">1777</span>
<span id="1778">1778</span>
<span id="1779">1779</span>
<span id="1780">1780</span>
<span id="1781">1781</span>
<span id="1782">1782</span>
<span id="1783">1783</span>
<span id="1784">1784</span>
<span id="1785">1785</span>
<span id="1786">1786</span>
<span id="1787">1787</span>
<span id="1788">1788</span>
<span id="1789">1789</span>
<span id="1790">1790</span>
<span id="1791">1791</span>
<span id="1792">1792</span>
<span id="1793">1793</span>
<span id="1794">1794</span>
<span id="1795">1795</span>
<span id="1796">1796</span>
<span id="1797">1797</span>
<span id="1798">1798</span>
<span id="1799">1799</span>
<span id="1800">1800</span>
<span id="1801">1801</span>
<span id="1802">1802</span>
<span id="1803">1803</span>
<span id="1804">1804</span>
<span id="1805">1805</span>
<span id="1806">1806</span>
<span id="1807">1807</span>
<span id="1808">1808</span>
<span id="1809">1809</span>
<span id="1810">1810</span>
<span id="1811">1811</span>
<span id="1812">1812</span>
<span id="1813">1813</span>
<span id="1814">1814</span>
<span id="1815">1815</span>
<span id="1816">1816</span>
<span id="1817">1817</span>
<span id="1818">1818</span>
<span id="1819">1819</span>
<span id="1820">1820</span>
<span id="1821">1821</span>
<span id="1822">1822</span>
<span id="1823">1823</span>
<span id="1824">1824</span>
<span id="1825">1825</span>
<span id="1826">1826</span>
<span id="1827">1827</span>
<span id="1828">1828</span>
<span id="1829">1829</span>
<span id="1830">1830</span>
<span id="1831">1831</span>
<span id="1832">1832</span>
<span id="1833">1833</span>
<span id="1834">1834</span>
<span id="1835">1835</span>
<span id="1836">1836</span>
<span id="1837">1837</span>
<span id="1838">1838</span>
<span id="1839">1839</span>
<span id="1840">1840</span>
<span id="1841">1841</span>
<span id="1842">1842</span>
<span id="1843">1843</span>
<span id="1844">1844</span>
<span id="1845">1845</span>
<span id="1846">1846</span>
<span id="1847">1847</span>
<span id="1848">1848</span>
<span id="1849">1849</span>
<span id="1850">1850</span>
<span id="1851">1851</span>
<span id="1852">1852</span>
<span id="1853">1853</span>
<span id="1854">1854</span>
<span id="1855">1855</span>
<span id="1856">1856</span>
<span id="1857">1857</span>
<span id="1858">1858</span>
<span id="1859">1859</span>
<span id="1860">1860</span>
<span id="1861">1861</span>
<span id="1862">1862</span>
<span id="1863">1863</span>
<span id="1864">1864</span>
<span id="1865">1865</span>
<span id="1866">1866</span>
<span id="1867">1867</span>
<span id="1868">1868</span>
<span id="1869">1869</span>
<span id="1870">1870</span>
<span id="1871">1871</span>
<span id="1872">1872</span>
<span id="1873">1873</span>
<span id="1874">1874</span>
<span id="1875">1875</span>
<span id="1876">1876</span>
<span id="1877">1877</span>
<span id="1878">1878</span>
<span id="1879">1879</span>
<span id="1880">1880</span>
<span id="1881">1881</span>
<span id="1882">1882</span>
<span id="1883">1883</span>
<span id="1884">1884</span>
<span id="1885">1885</span>
<span id="1886">1886</span>
<span id="1887">1887</span>
<span id="1888">1888</span>
</pre><pre class="rust"><code><span class="attribute">#![<span class="ident">doc</span> <span class="op">=</span> <span class="macro">__internal_module_doc!</span>(<span class="string">&quot;crate&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)]</span>
<span class="attribute">#![<span class="ident">doc</span> <span class="op">=</span> <span class="macro">include_str!</span>(<span class="string">&quot;./common.md&quot;</span>)]</span>

<span class="doccomment">/// The table of contents for [`__internal_module_doc`][].</span>
<span class="attribute">#[<span class="ident">rustfmt::skip</span>]</span>
<span class="attribute">#[<span class="ident">doc</span>(<span class="ident">hidden</span>)]</span>
<span class="kw">pub</span> <span class="kw">macro</span> <span class="ident">__internal_module_doc_toc</span>() {<span class="string">r#&quot;
- [Binders](#binders)
- [Initialization Order](#initialization-order)
- [Planned Features](#planned-features) &quot;#</span>} <span class="comment">// No EOL at the end</span>

<span class="doccomment">/// The part of the module-level documentation shared between `r3::bind` and</span>
<span class="doccomment">/// `r3_core::bind`. This is necessary because `r3::bind` itself isn&#39;t a</span>
<span class="doccomment">/// re-export of `r3_core::bind`, but it&#39;s desirable for it to have the same</span>
<span class="doccomment">/// documentation.</span>
<span class="attribute">#[<span class="ident">rustfmt::skip</span>]</span>
<span class="attribute">#[<span class="ident">doc</span>(<span class="ident">hidden</span>)]</span>
<span class="attribute">#[<span class="ident">macropol::macropol</span>]</span> <span class="comment">// Replace `$metavariables` in literals and doc comments</span>
<span class="kw">pub</span> <span class="kw">macro</span> <span class="ident">__internal_module_doc</span>(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">r3_core</span>:<span class="ident">expr</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">admonitions</span>:<span class="ident">expr</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">toc</span>:<span class="ident">expr</span>) {
    <span class="string">r#&quot;
Bindings ([`Bind`][]), a static storage with [runtime initialization][1] and
[configuration-time][2] borrow checking.

$admonitions

Bindings are essentially fancy global variables defined in a kernel
configuration. They are defined by [`Bind::define`][] and initialized by
provided closures at runtime. They can be consumed or borrowed by the entry
points of [executable kernel objects][4] or the initializers of another
bindings, with a dependency graph explicitly defined by the passing of
[*binders*][15].

The configuration system tracks the usage of bindings and employs static checks
to ensure that the borrowing rules are followed by the users of the bindings. It
aborts the compilation if the rules may be violated.

Bindings use hunks ([`Hunk`][3]) as a storage for their contents. Bindings are
initialized in [startup hooks][14], where [CPU Lock][17] is active, &lt;!--
[ref:startup_hook_cpu_lock_active] --&gt; and therefore most kernel services
are unavailable.

&lt;div class=&quot;admonition-follows&quot;&gt;&lt;/div&gt;

&gt; **Relation to Other Specifications:** [*Resources*][8] in [RTIC 1][7] serve
&gt; the similar need with a quite different design.
&gt; In R3, bindings are defined in modular, encapsulated configuration functions
&gt; and associated to various kernel objects. The configuration system takes all
&gt; definitions and figures out the correct initialization order.
&gt; In RTIC, all resources are defined in one place and initialized by an
&gt; application-provided `#[init]` function.

$toc

# Binders

A *binder* ([`Binder`][]) represents a specific borrow mode of a binding. A
configuration function creates a binding by calling one of [`Bind`][]&#39;s methods
and uses it in the definition of another object where the binding is intended to
be consumed, i.e., borrowed or moved out by its entry point or initializer. The
type a binder produces is called its *materialized* form.

```rust,ignore
use r3::{bind::bind, kernel::StaticTimer, prelude::*};

let count = bind((), || 0).finish(cfg);
//               ^^  ^^
//            .--&#39;    &#39;--------,
//       no binders  no materialized values

StaticTimer::define()
    // n.b. `(x,)` is a one-element tuple
    .start_with_bind((count.borrow_mut(),), |count: &amp;mut i32| {
        //            ^^^^^^^^^^^^^^^^^^            ^^^^^^^^
        //                    |                         |
        //         BindBorrowMut&lt;&#39;_, _, i32&gt;      &amp;&#39;call mut i32
        //                  gives...          for some lifetime &#39;call
    })
    .finish(b);
```

The only way for safe code to make a binding available to runtime code in a
meaningful way is to include a binder in a dependency list (e.g., the `binder`
parameter of [`ExecutableDefinerExt::start_with_bind`][]) as shown above or to
call [`Bind::as_ref`][] to create a [`BindRef`][], which is directly consumable
in runtime code. Most binders can&#39;t escape from a configuration function.

The following table lists all provided binders:

|     `Bind::`     |         Type        |     Confers      | On binding | On executable |
| ---------------- | ------------------- | ---------------- | :--------: | :-----------: |
| [`borrow`][]     | [`BindBorrow`][]    | `&amp;&#39;call T`       |     ✓      |       ✓       |
| [`borrow_mut`][] | [`BindBorrowMut`][] | `&amp;&#39;call mut T`   |     ✓      |       ✓       |
| [`take_ref`][]   | [`BindTakeRef`][]   | `&amp;&#39;static T`     |     ✓      |       ✓       |
| [`take_mut`][]   | [`BindTakeMut`][]   | `&amp;&#39;static mut T` |     ✓      |               |
| [`take`][]       | [`BindTake`][]      | `T`              |     ✓      |               |
| [`as_ref`][]     | [`BindRef`][]       | `&amp;&#39;static T`     |            |       ✓       |

[`borrow`]: Bind::borrow
[`borrow_mut`]: Bind::borrow_mut
[`take_ref`]: Bind::take_ref
[`take_mut`]: Bind::take_mut
[`take`]: Bind::take
[`as_ref`]: Bind::as_ref

- The **`Bind::`** column shows the methods to create the binders.

- The **Type** column shows the types representing the binders.

- The **Confers** column shows the respective materialized forms of the binders.
  The lifetime `&#39;call` represents the call duration of the consuming function.
   - For `&amp;&#39;call T` and `&amp;&#39;call mut T`, the caller has the freedom of choosing
     an arbitrary lifetime, so the consuming function must be generic over any
     lifetimes. In function and closure parameters, reference types without
     explicit lifetimes are automatically made generic in this way owing to [the
     lifetime elision rules][16].

- The **On binding** column shows which types of binders can be consumed by
  another binding&#39;s initializer via [`BindDefiner::init_with_bind`][].

- The **On executable** column shows which types of binders can be consumed
  by [executable objects][10], viz., [tasks][11], [interrupt handlers][12], and
  [timers][13], via [`ExecutableDefinerExt::start_with_bind`][].
    - An executable object may execute its entry point for multiple times
      throughout its lifetime. For this reason, an executable object is not
      allowed to consume `BindTake` (which moves out the value) or `BindTakeMut`
      (which mutably borrows the value indefinitely).

# Initialization Order

The configuration system determines the initialization order of the defined
bindings by [topological sorting][5] with a preference toward the definition
order. The specific algorithm is not a part of the stability guarantee.

# Planned Features

The following features are planned and may be implemented in the future:

- Reusing the storage of a binding whose lifetime has ended by having its
  contents moved out by [`BindTake`][] or completing its last borrow.
  &lt;!-- [tag:bind_storage_reuse] --&gt;

- Pruning unused bindings, unless they are marked as [`unpure`][6].
  &lt;!-- [ref:unpure_binding] --&gt;

- Phantom edges to enforce ordering between bindings.

- Pinning.

[1]: BindDefiner::init
[2]: $r3_core#static-configuration
[3]: crate::kernel::Hunk
[4]: ExecutableDefiner
[5]: https://en.wikipedia.org/wiki/Topological_sorting
[6]: BindDefiner::unpure
[7]: https://rtic.rs/1/book/en/
[8]: https://rtic.rs/1/book/en/by-example/resources.html
[9]: https://www.toppers.jp/index.html
[10]: ExecutableDefiner
[11]: crate::kernel::StaticTask
[12]: crate::kernel::StaticInterruptHandler
[13]: crate::kernel::StaticTimer
[14]: crate::kernel::StartupHook
[15]: #binders
[16]: https://doc.rust-lang.org/1.58.1/reference/lifetime-elision.html#lifetime-elision-in-functions
[17]: $r3_core#system-states
&quot;#</span>
}

<span class="kw">use</span> <span class="ident">core</span>::{<span class="ident">cell::UnsafeCell</span>, <span class="ident">marker::PhantomData</span>, <span class="ident">mem::MaybeUninit</span>};

<span class="kw">use</span> <span class="kw">crate</span>::{
    <span class="ident">closure::Closure</span>,
    <span class="ident">hunk::Hunk</span>,
    <span class="ident">kernel</span>::{<span class="self">self</span>, <span class="ident">cfg</span>, <span class="ident">prelude</span>::<span class="kw-2">*</span>, <span class="ident">raw</span>, <span class="ident">raw_cfg</span>, <span class="ident">StartupHook</span>},
    <span class="ident">utils</span>::{<span class="ident">refcell::RefCell</span>, <span class="ident">ComptimeVec</span>, <span class="ident">ConstAllocator</span>, <span class="ident">Init</span>, <span class="ident">PhantomInvariant</span>, <span class="ident">ZeroInit</span>},
};

<span class="kw">mod</span> <span class="ident">sorter</span>;
<span class="kw">mod</span> <span class="ident">tests_impls</span>;

<span class="doccomment">/// The priority of the [startup hooks][1] used to initialize [bindings][2].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: crate::kernel::StartupHook</span>
<span class="doccomment">/// [2]: Bind</span>
<span class="kw">pub</span> <span class="kw">const</span> <span class="ident">INIT_HOOK_PRIORITY</span>: <span class="ident">i32</span> <span class="op">=</span> <span class="number">0x4000_0000</span>;

<span class="comment">// Storage for the bindings</span>
<span class="comment">// ----------------------------------------------------------------------------</span>

<span class="attribute">#[<span class="ident">doc</span>(<span class="ident">hidden</span>)]</span>
<span class="attribute">#[<span class="ident">repr</span>(<span class="ident">transparent</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindData</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">UnsafeCell</span><span class="op">&lt;</span><span class="ident">MaybeUninit</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span><span class="op">&gt;</span>);

<span class="comment">// Safety: Thread safety is dealt with by the binder creation methods</span>
<span class="kw">unsafe</span> <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Sync</span> <span class="kw">for</span> <span class="ident">BindData</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> {}
<span class="kw">unsafe</span> <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Send</span> <span class="kw">for</span> <span class="ident">BindData</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> {}

<span class="doccomment">/// A type alias of `Hunk` specialized for [`Bind`].</span>
<span class="kw">type</span> <span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">Hunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">BindData</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span><span class="op">&gt;</span>;

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> <span class="ident">BindData</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">assume_init_ref</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="kw-2">&amp;</span><span class="ident">T</span> {
        <span class="kw">unsafe</span> { (<span class="kw-2">*</span><span class="self">self</span>.<span class="number">0</span>.<span class="ident">get</span>()).<span class="ident">assume_init_ref</span>() }
    }

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="comment">// Forming a mutable borrow from an immutable input is okay because we go</span>
    <span class="comment">// through `UnsafeCell`</span>
    <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">clippy::mut_from_ref</span>)]</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">assume_init_mut</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="kw-2">&amp;mut</span> <span class="ident">T</span> {
        <span class="kw">unsafe</span> { (<span class="kw-2">*</span><span class="self">self</span>.<span class="number">0</span>.<span class="ident">get</span>()).<span class="ident">assume_init_mut</span>() }
    }
}

<span class="comment">// Safety: Zero-initialization is valid for `MaybeUninit`</span>
<span class="kw">unsafe</span> <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> <span class="ident">ZeroInit</span> <span class="kw">for</span> <span class="ident">BindData</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> {}

<span class="comment">// Main configuration interface</span>
<span class="comment">// ----------------------------------------------------------------------------</span>

<span class="comment">// [ref:unsized_maybe_uninit] prevents `T: ?Sized`</span>
<span class="doccomment">/// A defined binding.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// The configuration-time metadata is stored in a pool with lifetime `&#39;pool`.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="ident">hunk</span>: <span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>,
    <span class="ident">bind_registry</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;pool</span> <span class="ident">RefCell</span><span class="op">&lt;</span><span class="ident">CfgBindRegistry</span><span class="op">&gt;</span>,
    <span class="ident">bind_i</span>: <span class="ident">usize</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Copy</span> <span class="kw">for</span> <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {}
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Clone</span> <span class="kw">for</span> <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">fn</span> <span class="ident">clone</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="self">Self</span> {
        <span class="kw-2">*</span><span class="self">self</span>
    }
}

<span class="doccomment">/// A [binder][1] that gives `&amp;T` to a bound function.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// Created by [`Bind::borrow`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: index.html#binders</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindBorrow</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="doccomment">/// A [binder][1] that gives `&amp;mut T` to a bound function.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// Created by [`Bind::borrow_mut`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: index.html#binders</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindBorrowMut</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="doccomment">/// A [binder][1] that gives `T` to a bound function.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// Created by [`Bind::take`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: index.html#binders</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindTake</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="doccomment">/// A [binder][1] that gives `&amp;&#39;static T` to a bound function.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// Created by [`Bind::take_ref`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: index.html#binders</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindTakeRef</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="doccomment">/// A [binder][1] that gives `&amp;&#39;static mut T` to a bound function.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// Created by [`Bind::take_mut`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: index.html#binders</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindTakeMut</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="doccomment">/// A reference to a [binding][1]. Doubles as a [binder][1].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// Created by [`Bind::as_ref`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// It doesn&#39;t provide access to the contents by itself because it could be</span>
<span class="doccomment">/// used before the binding is initialized. Index [`BindTable`][] by this type to</span>
<span class="doccomment">/// borrow the contents as `&amp;&#39;static T`.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: Bind</span>
<span class="doccomment">/// [2]: index.html#binders</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Copy</span> <span class="kw">for</span> <span class="ident">BindRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {}
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Clone</span> <span class="kw">for</span> <span class="ident">BindRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">fn</span> <span class="ident">clone</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="self">Self</span> {
        <span class="kw-2">*</span><span class="self">self</span>
    }
}

<span class="comment">// `BindDefiner` doesn&#39;t contain `T`, so this `impl` must use a concrete `T`</span>
<span class="comment">// for `define` to be usable</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, ()<span class="op">&gt;</span> {
    <span class="doccomment">/// Construct a `BindDefiner` to define a binding in [a configuration</span>
    <span class="doccomment">/// function](crate#static-configuration).</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">define</span>() -&gt; <span class="ident">BindDefiner</span><span class="op">&lt;</span>
        <span class="ident">System</span>,
        <span class="ident">private_bind_definer::BinderUnspecified</span>,
        <span class="ident">private_bind_definer::FuncUnspecified</span>,
    <span class="op">&gt;</span> {
        <span class="ident">BindDefiner::new</span>()
    }
}

<span class="doccomment">/// # Binders</span>
<span class="doccomment">///</span>
<span class="doccomment">/// The following methods are used to construct a [*binder*][1], which is a</span>
<span class="doccomment">/// reference to a binding with a specific borrowing mode.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: Binder</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="doccomment">/// Create a [`BindBorrow`][] binder, which gives `&amp;T` to a bound function.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">borrow</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">BindBorrow</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
    <span class="kw">where</span>
        <span class="ident">T</span>: <span class="ident">Sync</span>,
    {
        <span class="ident">BindBorrow</span>(<span class="kw-2">*</span><span class="self">self</span>)
    }

    <span class="doccomment">/// Create a [`BindBorrowMut`][] binder, which gives `&amp;mut T` to a bound</span>
    <span class="doccomment">/// function.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">borrow_mut</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">BindBorrowMut</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
    <span class="kw">where</span>
        <span class="ident">T</span>: <span class="ident">Send</span>,
    {
        <span class="ident">BindBorrowMut</span>(<span class="kw-2">*</span><span class="self">self</span>)
    }

    <span class="doccomment">/// Create a [`BindTake`][] binder, which gives `T` to a bound function.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">take</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">BindTake</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
    <span class="kw">where</span>
        <span class="ident">T</span>: <span class="ident">Send</span>,
    {
        <span class="ident">BindTake</span>(<span class="kw-2">*</span><span class="self">self</span>)
    }

    <span class="doccomment">/// Create a [`BindTakeRef`][] binder, which gives `&amp;&#39;static T` to a bound</span>
    <span class="doccomment">/// function.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">take_ref</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">BindTakeRef</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
    <span class="kw">where</span>
        <span class="ident">T</span>: <span class="ident">Sync</span>,
    {
        <span class="ident">BindTakeRef</span>(<span class="kw-2">*</span><span class="self">self</span>)
    }

    <span class="doccomment">/// Create a [`BindTakeMut`][] binder, which gives `&amp;&#39;static mut T` to a</span>
    <span class="doccomment">/// bound function.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">take_mut</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">BindTakeMut</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
    <span class="kw">where</span>
        <span class="ident">T</span>: <span class="ident">Send</span>,
    {
        <span class="ident">BindTakeMut</span>(<span class="kw-2">*</span><span class="self">self</span>)
    }

    <span class="doccomment">/// Construct a [`BindRef`][], which can be used to get `&amp;&#39;static T` from a</span>
    <span class="doccomment">/// [`BindTable`][]`&lt;System&gt;`.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// `BindRef` doubles as a [binder][2] that gives `&amp;&#39;static T` in a bound</span>
    <span class="doccomment">/// [executable object][1].</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// The configuration system can&#39;t track the usages of `BindRef` (note the</span>
    <span class="doccomment">/// lack of a lifetime parameter in its definition). As such, merely calling</span>
    <span class="doccomment">/// this method counts as a use of the binding whether the returned</span>
    <span class="doccomment">/// `BindRef` is actually used or not.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// [1]: ExecutableDefiner</span>
    <span class="doccomment">/// [2]: index.html#binders</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">as_ref</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">BindRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
    <span class="kw">where</span>
        <span class="ident">T</span>: <span class="ident">Sync</span>,
    {
        <span class="self">self</span>.<span class="ident">bind_registry</span>.<span class="ident">borrow_mut</span>().<span class="ident">binds</span>[<span class="self">self</span>.<span class="ident">bind_i</span>]
            .<span class="ident">users</span>
            .<span class="ident">push</span>((<span class="ident">BindUsage::Executable</span>, <span class="ident">BindBorrowType::TakeRef</span>));
        <span class="ident">BindRef</span>(<span class="self">self</span>.<span class="ident">hunk</span>)
    }
}

<span class="doccomment">/// # Miscellaneous Methods</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="doccomment">/// Get the raw [`Hunk`][] providing the backing store for this binding.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// The referent type of the returned `Hunk` is an opaque type that has the</span>
    <span class="doccomment">/// same representation as `T` (because of `#[repr(transparent)]`). You</span>
    <span class="doccomment">/// can use [`Hunk::transmute`][] to reinterpret it as you see fit.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// Calling this method alone does not extend the binding&#39;s lifetime nor</span>
    <span class="doccomment">/// prevent conflicting borrows from occurring. A dummy binding can be used</span>
    <span class="doccomment">/// to express the manner in which the raw hunk is used outside the</span>
    <span class="doccomment">/// configuration system&#39;s knowledge. For example, if the raw hunk is going</span>
    <span class="doccomment">/// to be mutably borrowed, the caller of this method should create a dummy</span>
    <span class="doccomment">/// [unpure][1] binding that consumes the binding by [`take_mut`][2].</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// [1]: BindDefiner::unpure</span>
    <span class="doccomment">/// [2]: Bind::take_mut</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">hunk</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
        <span class="self">self</span>.<span class="ident">hunk</span>
    }
}

<span class="doccomment">/// The definer (static builder) for [`Bind`].</span>
<span class="attribute">#[<span class="ident">doc</span> <span class="op">=</span> <span class="macro">include_str!</span>(<span class="string">&quot;./common.md&quot;</span>)]</span>
<span class="attribute">#[<span class="ident">must_use</span> <span class="op">=</span> <span class="string">&quot;must call `finish()` to complete registration&quot;</span>]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindDefiner</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">Binder</span>, <span class="ident">Func</span><span class="op">&gt;</span> {
    <span class="ident">_phantom</span>: <span class="ident">PhantomInvariant</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span>,
    <span class="ident">binder</span>: <span class="ident">Binder</span>,
    <span class="ident">func</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">Func</span><span class="op">&gt;</span>,
}

<span class="kw">mod</span> <span class="ident">private_bind_definer</span> {
    <span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BinderUnspecified</span>;
    <span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">FuncUnspecified</span>;
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span>
    <span class="ident">BindDefiner</span><span class="op">&lt;</span>
        <span class="ident">System</span>,
        <span class="ident">private_bind_definer::BinderUnspecified</span>,
        <span class="ident">private_bind_definer::FuncUnspecified</span>,
    <span class="op">&gt;</span>
{
    <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">new</span>() -&gt; <span class="self">Self</span> {
        <span class="self">Self</span> {
            <span class="ident">_phantom</span>: <span class="ident">Init::INIT</span>,
            <span class="ident">binder</span>: <span class="ident">private_bind_definer::BinderUnspecified</span>,
            <span class="ident">func</span>: <span class="prelude-val">Some</span>(<span class="ident">private_bind_definer::FuncUnspecified</span>),
        }
    }
}

<span class="doccomment">/// # Specifying the initializer function</span>
<span class="doccomment">///</span>
<span class="doccomment">/// One of the following methods should be used to specify the initializer for</span>
<span class="doccomment">/// the binding being defined.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span>
    <span class="ident">BindDefiner</span><span class="op">&lt;</span>
        <span class="ident">System</span>,
        <span class="ident">private_bind_definer::BinderUnspecified</span>,
        <span class="ident">private_bind_definer::FuncUnspecified</span>,
    <span class="op">&gt;</span>
{
    <span class="doccomment">/// Use the function to initialize the binding contents.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">init</span><span class="op">&lt;</span><span class="ident">Func</span><span class="op">&gt;</span>(<span class="self">self</span>, <span class="ident">func</span>: <span class="ident">Func</span>) -&gt; <span class="ident">BindDefiner</span><span class="op">&lt;</span><span class="ident">System</span>, (), <span class="ident">Func</span><span class="op">&gt;</span> {
        <span class="ident">BindDefiner</span> {
            <span class="ident">func</span>: <span class="prelude-val">Some</span>(<span class="ident">func</span>),
            <span class="ident">binder</span>: (),
            ..<span class="self">self</span>
        }
    }

    <span class="doccomment">/// Use the function with dependency to initialize the binding contents.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">init_with_bind</span><span class="op">&lt;</span><span class="ident">Binder</span>, <span class="ident">Func</span><span class="op">&gt;</span>(
        <span class="self">self</span>,
        <span class="ident">binder</span>: <span class="ident">Binder</span>,
        <span class="ident">func</span>: <span class="ident">Func</span>,
    ) -&gt; <span class="ident">BindDefiner</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">Binder</span>, <span class="ident">Func</span><span class="op">&gt;</span> {
        <span class="ident">BindDefiner</span> {
            <span class="ident">func</span>: <span class="prelude-val">Some</span>(<span class="ident">func</span>),
            <span class="ident">binder</span>,
            ..<span class="self">self</span>
        }
    }

    <span class="doccomment">/// Zero-initialize the binding contents.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">zeroed</span><span class="op">&lt;</span><span class="ident">T</span>: <span class="ident">ZeroInit</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident">BindDefiner</span><span class="op">&lt;</span><span class="ident">System</span>, (), <span class="ident">FnBindNever</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="comment">// Safety: `T: ZeroInit` means it&#39;s safe to zero-initialize</span>
        <span class="kw">unsafe</span> { <span class="self">self</span>.<span class="ident">zeroed_unchecked</span>() }
    }

    <span class="doccomment">/// Zero-initialize the binding contents even if it might be unsafe.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Safety</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// If zero initialization is not a valid bit pattern for `T`, accessing the</span>
    <span class="doccomment">/// contents may result in an undefined behavior.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">zeroed_unchecked</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident">BindDefiner</span><span class="op">&lt;</span><span class="ident">System</span>, (), <span class="ident">FnBindNever</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="ident">BindDefiner</span> {
            <span class="comment">// Hunk pool is zero-initialized by default</span>
            <span class="comment">// [ref:hunk_pool_is_zeroed]</span>
            <span class="ident">func</span>: <span class="prelude-val">None</span>,
            <span class="ident">binder</span>: (),
            ..<span class="self">self</span>
        }
    }

    <span class="doccomment">/// Skip the initialization of the binding contents even if it might be</span>
    <span class="doccomment">/// unsafe.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Safety</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// If the uninitialized state is not valid for `T`, accessing the</span>
    <span class="doccomment">/// contents may result in an undefined behavior.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">uninit_unchecked</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident">BindDefiner</span><span class="op">&lt;</span><span class="ident">System</span>, (), <span class="ident">FnBindNever</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span><span class="op">&gt;</span> {
        <span class="comment">// FIXME: True uninitialized hunks would be more desirable</span>
        <span class="comment">// Safety: Upheld by the caller</span>
        <span class="kw">unsafe</span> { <span class="self">self</span>.<span class="ident">zeroed_unchecked</span>() }
    }
}

<span class="doccomment">/// # Optional Parameters</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">Binder</span>, <span class="ident">Func</span><span class="op">&gt;</span> <span class="ident">BindDefiner</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">Binder</span>, <span class="ident">Func</span><span class="op">&gt;</span> {
    <span class="doccomment">/// Indicate that the evaluation of the initializer may cause a side-effect</span>
    <span class="doccomment">/// that the dependency solver must not remove implicitly.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// &lt;div class=&quot;admonition-follows&quot;&gt;&lt;/div&gt;</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// &gt; **Unimplemented:** Pruning unused bindings is not implemented yet.</span>
    <span class="doccomment">/// &gt; Therefore, this method is no-op. &lt;!-- [ref:unpure_binding] --&gt;</span>
    <span class="doccomment">///</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">unpure</span>(<span class="self">self</span>) -&gt; <span class="self">Self</span> {
        <span class="comment">// TODO: [tag:unpure_binding] Mark impurity</span>
        <span class="self">self</span>
    }
}

<span class="doccomment">/// # Finalization</span>
<span class="doccomment">///</span>
<span class="doccomment">/// The following method defines a binding using the provided parameter.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">Binder</span>, <span class="ident">Func</span><span class="op">&gt;</span> <span class="ident">BindDefiner</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">Binder</span>, <span class="ident">Func</span><span class="op">&gt;</span> {
    <span class="doccomment">/// Complete the definition of a binding, returning a reference to it.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">finish</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">C</span><span class="op">&gt;</span>(
        <span class="self">self</span>,
        <span class="ident">cfg</span>: <span class="kw-2">&amp;mut</span> <span class="ident">cfg::Cfg</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">C</span><span class="op">&gt;</span>,
    ) -&gt; <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="op">&lt;</span><span class="ident">Func</span> <span class="kw">as</span> <span class="ident">FnBind</span><span class="op">&lt;</span><span class="ident">Binder</span><span class="op">&gt;</span><span class="op">&gt;</span><span class="ident">::Output</span><span class="op">&gt;</span>
    <span class="kw">where</span>
        <span class="ident">C</span>: ~<span class="kw">const</span> <span class="ident">raw_cfg::CfgBase</span><span class="op">&lt;</span><span class="ident">System</span> <span class="op">=</span> <span class="ident">System</span><span class="op">&gt;</span>,
        <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
        <span class="ident">Func</span>: ~<span class="kw">const</span> <span class="ident">FnBind</span><span class="op">&lt;</span><span class="ident">Binder</span><span class="op">&gt;</span>,
    {
        <span class="kw">let</span> <span class="ident">hunk</span> <span class="op">=</span> <span class="ident">BindHunk::define</span>().<span class="ident">zeroed</span>().<span class="ident">finish</span>(<span class="ident">cfg</span>);

        <span class="kw">let</span> <span class="ident">bind_registry</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="ident">cfg</span>.<span class="ident">shared</span>.<span class="ident">bind_registry</span>;
        <span class="kw">let</span> <span class="ident">bind_i</span> <span class="op">=</span> <span class="ident">bind_registry</span>.<span class="ident">borrow</span>().<span class="ident">binds</span>.<span class="ident">len</span>();

        <span class="comment">// Construct the initializer for the binding being created</span>
        <span class="kw">let</span> <span class="ident">initializer</span> <span class="op">=</span> <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Some</span>(<span class="ident">func</span>) <span class="op">=</span> <span class="self">self</span>.<span class="ident">func</span> {
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">ctx</span> <span class="op">=</span> <span class="ident">CfgBindCtx</span> {
                <span class="ident">_phantom</span>: <span class="kw-2">&amp;</span>(),
                <span class="ident">usage</span>: <span class="ident">BindUsage::Bind</span>(<span class="ident">bind_i</span>),
            };
            <span class="kw">let</span> <span class="ident">initializer</span> <span class="op">=</span> <span class="ident">func</span>.<span class="ident">bind</span>(<span class="self">self</span>.<span class="ident">binder</span>, <span class="kw-2">&amp;mut</span> <span class="ident">ctx</span>);
            <span class="prelude-val">Some</span>(<span class="ident">Closure::from_fn_const</span>(
                <span class="attribute">#[<span class="ident">inline</span>]</span>
                <span class="kw">move</span> <span class="op">|</span><span class="op">|</span> {
                    <span class="kw">let</span> <span class="ident">output</span> <span class="op">=</span> <span class="ident">initializer</span>();
                    <span class="comment">// Safety: There&#39;s no conflicting borrows</span>
                    <span class="kw">unsafe</span> { <span class="ident">hunk</span>.<span class="number">0</span>.<span class="ident">get</span>().<span class="ident">write</span>(<span class="ident">MaybeUninit::new</span>(<span class="ident">output</span>)) };
                },
            ))
        } <span class="kw">else</span> {
            <span class="comment">// `(None, ())` should be harmless to `forget`</span>
            <span class="ident">core::mem::forget</span>((<span class="self">self</span>.<span class="ident">func</span>, <span class="self">self</span>.<span class="ident">binder</span>));
            <span class="prelude-val">None</span>
        };

        {
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">bind_registry</span> <span class="op">=</span> <span class="ident">bind_registry</span>.<span class="ident">borrow_mut</span>();
            <span class="macro">assert!</span>(<span class="ident">bind_i</span> <span class="op">==</span> <span class="ident">bind_registry</span>.<span class="ident">binds</span>.<span class="ident">len</span>());
            <span class="kw">let</span> <span class="ident">allocator</span> <span class="op">=</span> <span class="ident">bind_registry</span>.<span class="ident">binds</span>.<span class="ident">allocator</span>().<span class="ident">clone</span>();
            <span class="ident">bind_registry</span>
                .<span class="ident">binds</span>
                .<span class="ident">push</span>(<span class="ident">CfgBindInfo::new</span>(<span class="ident">initializer</span>, <span class="ident">allocator</span>));
        }

        <span class="ident">Bind</span> {
            <span class="ident">hunk</span>,
            <span class="ident">bind_registry</span>,
            <span class="ident">bind_i</span>,
        }
    }
}

<span class="doccomment">/// An internal utility to divide a [`Bind`][] into smaller parts.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// &lt;!-- [tag:bind_divide_by_take_mut] --&gt; This is currently implemented by</span>
<span class="doccomment">/// introducing artificial dependency edges to the produced parts, which is</span>
<span class="doccomment">/// prone to false dependencies due to conservatism. This may be relaxed in the</span>
<span class="doccomment">/// future.</span>
<span class="doccomment">/// `BindTakeMut` forces the value to stay indefinitely, but fortunately in the</span>
<span class="doccomment">/// current implementation this doesn&#39;t have an impact on the memory usage</span>
<span class="doccomment">/// because storage reuse isn&#39;t implemented yet. &lt;!-- [ref:bind_storage_reuse]</span>
<span class="doccomment">/// --&gt;</span>
<span class="doccomment">///</span>
<span class="doccomment">/// ```text</span>
<span class="doccomment">///                               TakeRef</span>
<span class="doccomment">///                                  ,---&gt; emitter0 (T0)</span>
<span class="doccomment">///             TakeMut              |</span>
<span class="doccomment">///    original ------&gt; collector ---+---&gt; emitter1 (T1)</span>
<span class="doccomment">///  (T0, T1, ...)                   |</span>
<span class="doccomment">///                                  &#39;---&gt; ...</span>
<span class="doccomment">///</span>
<span class="doccomment">/// ```</span>
<span class="kw">struct</span> <span class="ident">DivideBind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="ident">original_bind</span>: <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>,
    <span class="ident">collector_bind_i</span>: <span class="ident">usize</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">DivideBind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">new</span>(<span class="ident">original_bind</span>: <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>) -&gt; <span class="self">Self</span> {
        <span class="kw">let</span> <span class="ident">collector_bind_i</span>;

        {
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">bind_registry</span> <span class="op">=</span> <span class="ident">original_bind</span>.<span class="ident">bind_registry</span>.<span class="ident">borrow_mut</span>();

            <span class="comment">// Create the &quot;collector&quot; binding</span>
            <span class="ident">collector_bind_i</span> <span class="op">=</span> <span class="ident">bind_registry</span>.<span class="ident">binds</span>.<span class="ident">len</span>();
            <span class="kw">let</span> <span class="ident">allocator</span> <span class="op">=</span> <span class="ident">bind_registry</span>.<span class="ident">binds</span>.<span class="ident">allocator</span>().<span class="ident">clone</span>();
            <span class="ident">bind_registry</span>.<span class="ident">binds</span>.<span class="ident">push</span>(<span class="ident">CfgBindInfo::new</span>(<span class="prelude-val">None</span>, <span class="ident">allocator</span>));

            <span class="comment">// original → collector</span>
            <span class="comment">// Using `TakeMut` here is a conservative choice.</span>
            <span class="comment">// [ref:bind_divide_by_take_mut]</span>
            <span class="ident">bind_registry</span>.<span class="ident">binds</span>[<span class="ident">original_bind</span>.<span class="ident">bind_i</span>]
                .<span class="ident">users</span>
                .<span class="ident">push</span>((<span class="ident">BindUsage::Bind</span>(<span class="ident">collector_bind_i</span>), <span class="ident">BindBorrowType::TakeMut</span>));
        }

        <span class="self">Self</span> {
            <span class="ident">original_bind</span>,
            <span class="ident">collector_bind_i</span>,
        }
    }

    <span class="doccomment">/// Get the original binding&#39;s `BindHunk`.</span>
    <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">original_hunk</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
        <span class="self">self</span>.<span class="ident">original_bind</span>.<span class="ident">hunk</span>
    }

    <span class="doccomment">/// Create a new binding from the provided `BindHunk`, treating it as a</span>
    <span class="doccomment">/// portion of the original binding.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Safety</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// - `hunk` must represent a subset of [`Self::original_hunk`].</span>
    <span class="doccomment">/// - For a given original binding, there must be no overlaps between the</span>
    <span class="doccomment">///   `hunk`s passed to this method.</span>
    <span class="doccomment">///</span>
    <span class="kw">const</span> <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">slice</span><span class="op">&lt;</span><span class="ident">U</span><span class="op">&gt;</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">hunk</span>: <span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">U</span><span class="op">&gt;</span>) -&gt; <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">U</span><span class="op">&gt;</span> {
        <span class="kw">let</span> <span class="ident">emitter_bind_i</span>;

        {
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">bind_registry</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">original_bind</span>.<span class="ident">bind_registry</span>.<span class="ident">borrow_mut</span>();

            <span class="comment">// Create the &quot;collector&quot; binding</span>
            <span class="ident">emitter_bind_i</span> <span class="op">=</span> <span class="ident">bind_registry</span>.<span class="ident">binds</span>.<span class="ident">len</span>();
            <span class="kw">let</span> <span class="ident">allocator</span> <span class="op">=</span> <span class="ident">bind_registry</span>.<span class="ident">binds</span>.<span class="ident">allocator</span>().<span class="ident">clone</span>();
            <span class="ident">bind_registry</span>.<span class="ident">binds</span>.<span class="ident">push</span>(<span class="ident">CfgBindInfo::new</span>(<span class="prelude-val">None</span>, <span class="ident">allocator</span>));

            <span class="comment">// collector → emitter</span>
            <span class="ident">bind_registry</span>.<span class="ident">binds</span>[<span class="self">self</span>.<span class="ident">collector_bind_i</span>]
                .<span class="ident">users</span>
                .<span class="ident">push</span>((<span class="ident">BindUsage::Bind</span>(<span class="ident">emitter_bind_i</span>), <span class="ident">BindBorrowType::TakeRef</span>));
        }

        <span class="ident">Bind</span> {
            <span class="ident">hunk</span>,
            <span class="ident">bind_registry</span>: <span class="self">self</span>.<span class="ident">original_bind</span>.<span class="ident">bind_registry</span>,
            <span class="ident">bind_i</span>: <span class="ident">emitter_bind_i</span>,
        }
    }
}

<span class="doccomment">/// An extension trait for destructing [`Bind`][]`&lt;_, (T0, T1, ...)&gt;` into</span>
<span class="doccomment">/// individual bindings `(Bind&lt;_, T0&gt;, Bind&lt;_, T1&gt;, ...)`.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// &lt;div class=&quot;admonition-follows&quot;&gt;&lt;/div&gt;</span>
<span class="doccomment">///</span>
<span class="doccomment">/// &gt; **Temporary Restrictions:** Currently the destruction makes the original</span>
<span class="doccomment">/// &gt; value completely inaccessible owing to it being implemented by</span>
<span class="doccomment">/// &gt; [`BindTakeMut`][]. Essentially, this divides the timeline into two parts:</span>
<span class="doccomment">/// &gt; the first part where only the pre-destruction binding (`Bind&lt;_, (T0, T1,</span>
<span class="doccomment">/// &gt; ...)&gt;`) can be borrowed and the second part where only the</span>
<span class="doccomment">/// &gt; post-destruction bindings (`Bind&lt;_, T0&gt;, Bind&lt;_, T1&gt;, ...`) can be</span>
<span class="doccomment">/// &gt; borrowed. &lt;!-- [ref:bind_divide_by_take_mut] --&gt;</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Examples</span>
<span class="doccomment">///</span>
<span class="doccomment">/// ```rust</span>
<span class="doccomment">/// #![feature(const_trait_impl)]</span>
<span class="doccomment">/// #![feature(const_mut_refs)]</span>
<span class="doccomment">/// use r3_core::{bind::Bind, kernel::{Cfg, traits}, prelude::*};</span>
<span class="doccomment">///</span>
<span class="doccomment">/// const fn configure_app&lt;C&gt;(cfg: &amp;mut Cfg&lt;C&gt;)</span>
<span class="doccomment">/// where</span>
<span class="doccomment">///     C: ~const traits::CfgStatic,</span>
<span class="doccomment">/// {</span>
<span class="doccomment">///     let values = Bind::define().init(|| (12, 34)).finish(cfg);</span>
<span class="doccomment">///     let (value0, value1) = values.unzip();</span>
<span class="doccomment">///     Bind::define()</span>
<span class="doccomment">///         .init_with_bind((value0.take_mut(),), |x: &amp;mut i32| assert_eq!(*x, 12))</span>
<span class="doccomment">///         .unpure()</span>
<span class="doccomment">///         .finish(cfg);</span>
<span class="doccomment">///     Bind::define()</span>
<span class="doccomment">///         .init_with_bind((value1.take_mut(),), |x: &amp;mut i32| assert_eq!(*x, 34))</span>
<span class="doccomment">///         .unpure()</span>
<span class="doccomment">///         .finish(cfg);</span>
<span class="doccomment">/// }</span>
<span class="doccomment">/// ```</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is covered by the application-side API stability guarantee.</span>
<span class="doccomment">/// External implementation of this trait is not allowed.</span>
<span class="attribute">#[<span class="ident">doc</span> <span class="op">=</span> <span class="macro">include_str!</span>(<span class="string">&quot;./common.md&quot;</span>)]</span>
<span class="kw">pub</span> <span class="kw">trait</span> <span class="ident">UnzipBind</span> {
    <span class="kw">type</span> <span class="ident">Target</span>;
    <span class="doccomment">/// Destruct [`Bind`][] into individual bindings.</span>
    <span class="kw">fn</span> <span class="ident">unzip</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span>;
}

<span class="doccomment">/// A helper trait to provide the field offsets of tuple types.</span>
<span class="kw">trait</span> <span class="ident">TupleFieldOffsets</span> {
    <span class="kw">const</span> <span class="ident">FIELD_OFFSETS</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;static</span> [<span class="ident">usize</span>];
}

<span class="macro">macro_rules!</span> <span class="ident">impl_unzip_bind_for_tuples</span> {
    ( @<span class="ident">start</span> $(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">x</span>:<span class="ident">tt</span>)<span class="op">*</span> ) =&gt; {
        <span class="macro">impl_unzip_bind_for_tuples!</span> { @<span class="ident">iter</span> [] [$(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">x</span>)<span class="kw-2">*</span>] }
    };

    <span class="comment">// inductive case</span>
    ( @<span class="ident">iter</span>
        [$((<span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span>:<span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>:<span class="ident">tt</span>))<span class="kw-2">*</span>]
        [<span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_head</span>:<span class="ident">tt</span> $(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_tail</span>:<span class="ident">tt</span>)<span class="kw-2">*</span>]
    ) =&gt; {
        <span class="macro">impl_unzip_bind_for_tuples!</span> { @<span class="ident">iter</span> [$((<span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>))<span class="op">*</span> <span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_head</span>] [$(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_tail</span>)<span class="kw-2">*</span>] }

        <span class="kw">impl</span><span class="op">&lt;</span>$( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span>, )<span class="kw-2">*</span><span class="op">&gt;</span> <span class="ident">TupleFieldOffsets</span> <span class="kw">for</span> ($( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span>, )<span class="kw-2">*</span>) {
            <span class="kw">const</span> <span class="ident">FIELD_OFFSETS</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;static</span> [<span class="ident">usize</span>] <span class="op">=</span> <span class="kw-2">&amp;</span>[
                $( <span class="macro">memoffset::offset_of_tuple!</span>(<span class="self">Self</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>) ),<span class="op">*</span>
            ];
        }
        <span class="kw">impl</span><span class="op">&lt;</span>
            <span class="ident">System</span>,
            $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span>, )<span class="op">*</span>
        <span class="op">&gt;</span> <span class="ident">TupleFieldOffsets</span> <span class="kw">for</span> <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span>, <span class="ident">System</span>, ($( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span>, )<span class="kw-2">*</span>)<span class="op">&gt;</span> {
            <span class="kw">const</span> <span class="ident">FIELD_OFFSETS</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;static</span> [<span class="ident">usize</span>] <span class="op">=</span> <span class="op">&lt;</span>($( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span>, )<span class="kw-2">*</span>)<span class="op">&gt;</span><span class="ident">::FIELD_OFFSETS</span>;
        }

        <span class="kw">impl</span><span class="op">&lt;</span>
            <span class="lifetime">&#39;pool</span>,
            <span class="ident">System</span>,
            $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span>, )<span class="op">*</span>
        <span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">UnzipBind</span> <span class="kw">for</span> <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, ( $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span>, )<span class="op">*</span> )<span class="op">&gt;</span>
        {
            <span class="kw">type</span> <span class="ident">Target</span> <span class="op">=</span> ( $( <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span><span class="op">&gt;</span>, )<span class="op">*</span> );

            <span class="kw">fn</span> <span class="ident">unzip</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span> {
                <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">unused_unsafe</span>)]</span> <span class="comment">// for `Bind&lt;&#39;_, _, ()&gt;`</span>
                <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">clippy::unused_unit</span>)]</span> <span class="comment">// for `Bind&lt;&#39;_, _, ()&gt;`</span>
                <span class="kw">unsafe</span> {
                    <span class="kw">let</span> <span class="ident">divide</span> <span class="op">=</span> <span class="ident">DivideBind::new</span>(<span class="self">self</span>);
                    <span class="kw">let</span> <span class="ident">hunk</span> <span class="op">=</span> <span class="ident">divide</span>.<span class="ident">original_hunk</span>();
                    <span class="kw">let</span> <span class="kw">_</span> <span class="op">=</span> <span class="ident">hunk</span>;

                    ($(
                        <span class="ident">divide</span>.<span class="ident">slice</span>::<span class="op">&lt;</span><span class="macro-nonterminal">$</span><span class="macro-nonterminal">FieldI</span><span class="op">&gt;</span>(
                            <span class="ident">hunk</span>.<span class="ident">transmute</span>::<span class="op">&lt;</span><span class="ident">u8</span><span class="op">&gt;</span>()
                                .<span class="ident">wrapping_offset</span>(<span class="ident"><span class="self">Self</span>::FIELD_OFFSETS</span>[<span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>] <span class="kw">as</span> <span class="ident">isize</span>)
                                .<span class="ident">transmute</span>()
                        ),
                    )<span class="kw-2">*</span>)
                }
            }
        }
    }; <span class="comment">// end of macro arm</span>

    <span class="comment">// base case</span>
    ( @<span class="ident">iter</span> [$(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">_discard</span>:<span class="ident">tt</span>)<span class="kw-2">*</span>] [] ) =&gt; {}
}

<span class="macro">seq_macro::seq!</span>(<span class="ident">I</span> <span class="kw">in</span> <span class="number">0</span>..<span class="number">16</span> { <span class="macro">impl_unzip_bind_for_tuples!</span> { @<span class="ident">start</span> #( (<span class="ident">Field</span>~<span class="ident">I</span>, <span class="ident">I</span>) )<span class="op">*</span> } });

<span class="kw">impl</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="kw">const</span> <span class="ident">LEN</span>: <span class="ident">usize</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">UnzipBind</span> <span class="kw">for</span> <span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, [<span class="ident">T</span>; <span class="ident">LEN</span>]<span class="op">&gt;</span> {
    <span class="kw">type</span> <span class="ident">Target</span> <span class="op">=</span> [<span class="ident">Bind</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>; <span class="ident">LEN</span>];

    <span class="kw">fn</span> <span class="ident">unzip</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span> {
        <span class="kw">unsafe</span> {
            <span class="kw">let</span> <span class="ident">divide</span> <span class="op">=</span> <span class="ident">DivideBind::new</span>(<span class="self">self</span>);
            <span class="kw">let</span> <span class="ident">hunk</span> <span class="op">=</span> <span class="ident">divide</span>.<span class="ident">original_hunk</span>();

            <span class="comment">// `core::array::from_fn` isn&#39;t `const fn` [ref:const_array_from_fn]</span>
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">out</span> <span class="op">=</span>
                <span class="ident">ComptimeVec::new_in</span>(<span class="self">self</span>.<span class="ident">bind_registry</span>.<span class="ident">borrow</span>().<span class="ident">binds</span>.<span class="ident">allocator</span>().<span class="ident">clone</span>());

            <span class="comment">// `for` loops are unusable in `const fn` [ref:const_for]</span>
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">i</span> <span class="op">=</span> <span class="number">0</span>;
            <span class="kw">while</span> <span class="ident">i</span> <span class="op">&lt;</span> <span class="ident">LEN</span> {
                <span class="ident">out</span>.<span class="ident">push</span>(<span class="ident">divide</span>.<span class="ident">slice</span>(<span class="ident">hunk</span>.<span class="ident">transmute</span>::<span class="op">&lt;</span><span class="ident">BindData</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span><span class="op">&gt;</span>().<span class="ident">wrapping_offset</span>(<span class="ident">i</span> <span class="kw">as</span> <span class="ident">isize</span>)));
                <span class="ident">i</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
            }

            <span class="ident">out</span>.<span class="ident">to_array</span>()
        }
    }
}

<span class="comment">// Runtime binding registry</span>
<span class="comment">// ----------------------------------------------------------------------------</span>

<span class="doccomment">/// Represents a permission to dereference [`BindRef`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Example</span>
<span class="doccomment">///</span>
<span class="doccomment">/// ```rust</span>
<span class="doccomment">/// #![feature(const_trait_impl)]</span>
<span class="doccomment">/// #![feature(const_mut_refs)]</span>
<span class="doccomment">/// use r3_core::{</span>
<span class="doccomment">///     bind::{Bind, BindRef, BindTable},</span>
<span class="doccomment">///     kernel::{cfg::Cfg, traits, StaticTask},</span>
<span class="doccomment">///     prelude::*,</span>
<span class="doccomment">/// };</span>
<span class="doccomment">///</span>
<span class="doccomment">/// const fn configure_app&lt;C&gt;(cfg: &amp;mut Cfg&lt;C&gt;)</span>
<span class="doccomment">/// where</span>
<span class="doccomment">///     C: ~const traits::CfgTask,</span>
<span class="doccomment">///     C::System: traits::KernelStatic,</span>
<span class="doccomment">/// {</span>
<span class="doccomment">///     let foo = Bind::define().init(|| {</span>
<span class="doccomment">///         // `BindTable::get()` will fail because some bindings might not</span>
<span class="doccomment">///         // be initialized at this point</span>
<span class="doccomment">///         assert!(BindTable::&lt;C::System&gt;::get().is_err());</span>
<span class="doccomment">///</span>
<span class="doccomment">///         42</span>
<span class="doccomment">///     }).finish(cfg).as_ref();</span>
<span class="doccomment">///</span>
<span class="doccomment">///     StaticTask::define()</span>
<span class="doccomment">///         .start(move || {</span>
<span class="doccomment">///             // Task code can get `BindTable` because tasks can only</span>
<span class="doccomment">///             // run after the boot phase is complete</span>
<span class="doccomment">///             let bt = BindTable::get().unwrap();</span>
<span class="doccomment">///             assert_eq!(bt[foo], 42);</span>
<span class="doccomment">///         })</span>
<span class="doccomment">///         .priority(2)</span>
<span class="doccomment">///         .active(true)</span>
<span class="doccomment">///         .finish(cfg);</span>
<span class="doccomment">/// }</span>
<span class="doccomment">/// ```</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BindTable</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span> {
    <span class="ident">_phantom</span>: <span class="ident">PhantomInvariant</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span>,
}

<span class="doccomment">/// Error type for [`BindTable::get`][].</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>, <span class="ident">Clone</span>, <span class="ident">Copy</span>, <span class="ident">PartialEq</span>, <span class="ident">Eq</span>, <span class="ident">Hash</span>, <span class="ident">PartialOrd</span>, <span class="ident">Ord</span>)]</span>
<span class="kw">pub</span> <span class="kw">enum</span> <span class="ident">GetBindTableError</span> {
    <span class="doccomment">/// [The boot phase][] is not complete.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// [the boot phase]: crate#threads</span>
    <span class="ident">BadContext</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span> <span class="ident">BindTable</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="doccomment">/// Get a reference to `BindTable` if [the boot phase][] is complete.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// Returns `Err(BadContext)` if the boot phase hasn&#39;t completed yet, and</span>
    <span class="doccomment">/// therefore it&#39;s unsafe to dereference [`BindRef`]s.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// [the boot phase]: crate#threads</span>
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">pub</span> <span class="kw">fn</span> <span class="ident">get</span>() -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="lifetime">&#39;static</span> <span class="self">Self</span>, <span class="ident">GetBindTableError</span><span class="op">&gt;</span> {
        <span class="kw">if</span> <span class="ident">System::is_boot_complete</span>() {
            <span class="prelude-val">Ok</span>(<span class="kw-2">&amp;</span><span class="self">Self</span> {
                <span class="ident">_phantom</span>: <span class="ident">Init::INIT</span>,
            })
        } <span class="kw">else</span> {
            <span class="prelude-val">Err</span>(<span class="ident">GetBindTableError::BadContext</span>)
        }
    }

    <span class="doccomment">/// Get a reference to `BindTable` without checking if it&#39;s safe to do so</span>
    <span class="doccomment">/// in the current context.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Safety</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// The returned reference may be used to borrow binding contents that are</span>
    <span class="doccomment">/// uninitialized or being mutably borrowed by a binding initializer.</span>
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">get_unchecked</span>() -&gt; <span class="kw-2">&amp;</span><span class="lifetime">&#39;static</span> <span class="self">Self</span> {
        <span class="kw-2">&amp;</span><span class="self">Self</span> {
            <span class="ident">_phantom</span>: <span class="ident">Init::INIT</span>,
        }
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">core::ops::Index</span><span class="op">&lt;</span><span class="ident">BindRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">BindTable</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
{
    <span class="kw">type</span> <span class="ident">Output</span> <span class="op">=</span> <span class="ident">T</span>;

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">fn</span> <span class="ident">index</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">index</span>: <span class="ident">BindRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>) -&gt; <span class="kw-2">&amp;</span><span class="ident"><span class="self">Self</span>::Output</span> {
        <span class="comment">// Safety: The possession of `BindRef` and `BindTable` indicates it&#39;s</span>
        <span class="comment">// safe to do so</span>
        <span class="kw">unsafe</span> { <span class="ident">BindHunk::as_ref</span>(<span class="ident">index</span>.<span class="number">0</span>).<span class="ident">assume_init_ref</span>() }
    }
}

<span class="comment">// Configuration-time binding registry</span>
<span class="comment">// ----------------------------------------------------------------------------</span>

<span class="kw">pub</span>(<span class="kw">crate</span>) <span class="kw">struct</span> <span class="ident">CfgBindRegistry</span> {
    <span class="ident">binds</span>: <span class="ident">ComptimeVec</span><span class="op">&lt;</span><span class="ident">CfgBindInfo</span><span class="op">&gt;</span>,
}

<span class="kw">struct</span> <span class="ident">CfgBindInfo</span> {
    <span class="doccomment">/// The initializer for the binder. It&#39;ll be registered as a startup hook</span>
    <span class="doccomment">/// on finalization.</span>
    <span class="ident">initializer</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">Closure</span><span class="op">&gt;</span>,
    <span class="doccomment">/// The uses of this binding.</span>
    <span class="ident">users</span>: <span class="ident">ComptimeVec</span><span class="op">&lt;</span>(<span class="ident">BindUsage</span>, <span class="ident">BindBorrowType</span>)<span class="op">&gt;</span>,
}

<span class="kw">impl</span> <span class="ident">CfgBindRegistry</span> {
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">new_in</span>(<span class="ident">allocator</span>: <span class="ident">ConstAllocator</span>) -&gt; <span class="self">Self</span> {
        <span class="self">Self</span> {
            <span class="ident">binds</span>: <span class="ident">ComptimeVec::new_in</span>(<span class="ident">allocator</span>),
        }
    }

    <span class="doccomment">/// Determine the initialization order of the defined bindings and register</span>
    <span class="doccomment">/// startup hooks to initialize them at runtime.</span>
    <span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">finalize</span><span class="op">&lt;</span><span class="ident">C</span><span class="op">&gt;</span>(<span class="kw-2">&amp;mut</span> <span class="self">self</span>, <span class="ident">cfg</span>: <span class="kw-2">&amp;mut</span> <span class="ident">cfg::Cfg</span><span class="op">&lt;</span><span class="ident">C</span><span class="op">&gt;</span>)
    <span class="kw">where</span>
        <span class="ident">C</span>: ~<span class="kw">const</span> <span class="ident">raw_cfg::CfgBase</span>,
    {
        <span class="kw">struct</span> <span class="ident">Callback</span><span class="op">&lt;</span><span class="lifetime">&#39;a</span><span class="op">&gt;</span> {
            <span class="ident">binds</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;a</span> [<span class="ident">CfgBindInfo</span>],
            <span class="ident">bind_init_order</span>: <span class="ident">ComptimeVec</span><span class="op">&lt;</span><span class="ident">usize</span><span class="op">&gt;</span>,
        }

        <span class="kw">impl</span> <span class="kw">const</span> <span class="ident">sorter::SorterCallback</span> <span class="kw">for</span> <span class="ident">Callback</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span> {
            <span class="kw">fn</span> <span class="ident">push_bind_order</span>(<span class="kw-2">&amp;mut</span> <span class="self">self</span>, <span class="ident">bind_i</span>: <span class="ident">usize</span>) {
                <span class="self">self</span>.<span class="ident">bind_init_order</span>.<span class="ident">push</span>(<span class="ident">bind_i</span>);
            }

            <span class="kw">fn</span> <span class="ident">report_error</span>(<span class="kw-2">&amp;mut</span> <span class="self">self</span>, <span class="ident">e</span>: <span class="ident">sorter::SorterError</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) {
                <span class="comment">// TODO: Collect all errors and report at once</span>
                <span class="comment">// [tag:bind_finalization_immediate_panic] The errors are</span>
                <span class="comment">// reported by panicking immediately for now</span>
                <span class="kw">match</span> <span class="ident">e</span> {
                    <span class="ident">sorter::SorterError::BindCycle</span> { <span class="ident">bind_is</span> } =&gt; {
                        <span class="kw">let</span> <span class="kw">_</span> <span class="op">=</span> <span class="ident">bind_is</span>; <span class="comment">// TODO: Display the bindings&#39; names</span>
                        <span class="macro">panic!</span>(<span class="string">&quot;the binding initialization order contains a cycle&quot;</span>);
                    }
                    <span class="ident">sorter::SorterError::ConflictingIndefiniteBorrow</span> { <span class="ident">bind_i</span> } =&gt; {
                        <span class="kw">let</span> <span class="kw">_</span> <span class="op">=</span> <span class="ident">bind_i</span>; <span class="comment">// TODO: Display the binding&#39;s name</span>
                        <span class="macro">panic!</span>(<span class="string">&quot;conflicting indefinite borrows&quot;</span>);
                    }
                }
            }

            <span class="kw">fn</span> <span class="ident">num_binds</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="ident">usize</span> {
                <span class="self">self</span>.<span class="ident">binds</span>.<span class="ident">len</span>()
            }

            <span class="kw">fn</span> <span class="ident">bind_users</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">bind_i</span>: <span class="ident">usize</span>) -&gt; <span class="kw-2">&amp;</span>[(<span class="ident">BindUsage</span>, <span class="ident">BindBorrowType</span>)] {
                <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">binds</span>[<span class="ident">bind_i</span>].<span class="ident">users</span>
            }
        }

        <span class="kw">let</span> <span class="ident">allocator</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">binds</span>.<span class="ident">allocator</span>();

        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">callback</span> <span class="op">=</span> <span class="ident">Callback</span> {
            <span class="ident">binds</span>: <span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">binds</span>,
            <span class="ident">bind_init_order</span>: <span class="ident">ComptimeVec::with_capacity_in</span>(<span class="self">self</span>.<span class="ident">binds</span>.<span class="ident">len</span>(), <span class="ident">allocator</span>.<span class="ident">clone</span>()),
        };

        <span class="ident">sorter::sort_bindings</span>(
            <span class="kw-2">&amp;mut</span> <span class="ident">callback</span>,
            <span class="kw-2">&amp;mut</span> <span class="ident">ComptimeVec::repeat_in</span>(<span class="ident">allocator</span>.<span class="ident">clone</span>(), <span class="ident">Init::INIT</span>, <span class="self">self</span>.<span class="ident">binds</span>.<span class="ident">len</span>()),
            <span class="kw-2">&amp;mut</span> <span class="ident">ComptimeVec::repeat_in</span>(<span class="ident">allocator</span>.<span class="ident">clone</span>(), <span class="ident">Init::INIT</span>, <span class="self">self</span>.<span class="ident">binds</span>.<span class="ident">len</span>()),
            <span class="kw-2">&amp;mut</span> <span class="ident">ComptimeVec::new_in</span>(<span class="ident">allocator</span>.<span class="ident">clone</span>()),
            <span class="kw-2">&amp;mut</span> <span class="ident">ComptimeVec::new_in</span>(<span class="ident">allocator</span>.<span class="ident">clone</span>()),
        );

        <span class="comment">// Because of [ref:bind_finalization_immediate_panic], reaching here</span>
        <span class="comment">// means the operation was successful</span>

        <span class="comment">// `for` loops are barely useful in `const fn` at the moment</span>
        <span class="comment">// [ref:const_for]</span>
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">i</span> <span class="op">=</span> <span class="number">0</span>;
        <span class="kw">while</span> <span class="ident">i</span> <span class="op">&lt;</span> <span class="ident">callback</span>.<span class="ident">bind_init_order</span>.<span class="ident">len</span>() {
            <span class="kw">let</span> <span class="ident">bind_i</span> <span class="op">=</span> <span class="ident">callback</span>.<span class="ident">bind_init_order</span>[<span class="ident">i</span>];

            <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Some</span>(<span class="ident">initializer</span>) <span class="op">=</span> <span class="self">self</span>.<span class="ident">binds</span>[<span class="ident">bind_i</span>].<span class="ident">initializer</span> {
                <span class="ident">StartupHook::define</span>()
                    .<span class="ident">start</span>(<span class="ident">initializer</span>)
                    .<span class="ident">priority</span>(<span class="ident">INIT_HOOK_PRIORITY</span>)
                    .<span class="ident">finish</span>(<span class="ident">cfg</span>);
            }

            <span class="ident">i</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
        }
    }
}

<span class="kw">impl</span> <span class="ident">CfgBindInfo</span> {
    <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">new</span>(<span class="ident">initializer</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">Closure</span><span class="op">&gt;</span>, <span class="ident">allocator</span>: <span class="ident">ConstAllocator</span>) -&gt; <span class="self">Self</span> {
        <span class="ident">CfgBindInfo</span> {
            <span class="ident">initializer</span>,
            <span class="ident">users</span>: <span class="ident">ComptimeVec::new_in</span>(<span class="ident">allocator</span>),
        }
    }
}

<span class="attribute">#[<span class="ident">doc</span>(<span class="ident">hidden</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;pool</span><span class="op">&gt;</span> {
    <span class="ident">_phantom</span>: <span class="kw-2">&amp;</span><span class="lifetime">&#39;pool</span> (),
    <span class="ident">usage</span>: <span class="ident">BindUsage</span>,
}

<span class="doccomment">/// A place where a binding is consumed.</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Copy</span>, <span class="ident">PartialEq</span>, <span class="ident">Eq</span>)]</span>
<span class="kw">enum</span> <span class="ident">BindUsage</span> {
    <span class="doccomment">/// The initializer of another binding.</span>
    <span class="ident">Bind</span>(<span class="ident">usize</span>),
    <span class="doccomment">/// An executable object (i.e., objects defined by [`ExecutableDefiner`]).</span>
    <span class="ident">Executable</span>,
}

<span class="doccomment">/// The manner in which a binding is consumed.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// Note that this represents the duration in which a binding is borrowed, not</span>
<span class="doccomment">/// the lifetime passed to an application-provided function. E.g.,</span>
<span class="doccomment">/// `BindBorrowMut` may give `&amp;mut T` to a task entry point, but this is</span>
<span class="doccomment">/// represented by `BindBorrowType::TakeMut` because the task can be started</span>
<span class="doccomment">/// any time and repeatedly during the application&#39;s lifetime</span>
<span class="doccomment">/// [tag:borrow_is_indefinite_for_executable].</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Copy</span>, <span class="ident">PartialEq</span>, <span class="ident">Eq</span>)]</span>
<span class="kw">enum</span> <span class="ident">BindBorrowType</span> {
    <span class="doccomment">/// Gives `&amp;T` that is valid for the consumption duration.</span>
    <span class="doccomment">/// Invalid for executables [ref:borrow_is_indefinite_for_executable].</span>
    <span class="ident">Borrow</span>,
    <span class="doccomment">/// Gives `&amp;mut T` that is valid for the consumption duration.</span>
    <span class="doccomment">/// Invalid for executables [ref:borrow_is_indefinite_for_executable].</span>
    <span class="ident">BorrowMut</span>,
    <span class="doccomment">/// Gives `T`. This is similar to [`Self::TakeMut`][] except that the</span>
    <span class="doccomment">/// storage may be freed up after the use. This is also similar to</span>
    <span class="doccomment">/// [`Self::BorrowMut`][] except that the binding is reverted to an</span>
    <span class="doccomment">/// uninitialized state, and the storage is available for reuse starting</span>
    <span class="doccomment">/// from the consuming function (whereas `BorrowMut` must wait until the</span>
    <span class="doccomment">/// completion of the consuming function).</span>
    <span class="ident">Take</span>,
    <span class="doccomment">/// Gives `&amp;&#39;static T`. This is an indefinite borrow.</span>
    <span class="ident">TakeRef</span>,
    <span class="doccomment">/// Gives `&amp;&#39;static mut T`. This is an indefinite borrow.</span>
    <span class="ident">TakeMut</span>,
}

<span class="comment">// Extensions for the definer objects</span>
<span class="comment">// ----------------------------------------------------------------------------</span>

<span class="doccomment">/// A trait for definer objects (static builders) for kernel objects that can</span>
<span class="doccomment">/// spawn a thread that executes after the execution of all startup hooks is</span>
<span class="doccomment">/// complete.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// See [`ExecutableDefinerExt`][] for an extension trait providing a method</span>
<span class="doccomment">/// to specify a closure that consumes [binders][1].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: index.html#binders</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Safety</span>
<span class="doccomment">///</span>
<span class="doccomment">/// At any point of time, the provided [`Closure`] must never be invoked by two</span>
<span class="doccomment">/// threads simultaneously. It can be called for multiple times, however.</span>
<span class="kw">pub</span> <span class="kw">unsafe</span> <span class="kw">trait</span> <span class="ident">ExecutableDefiner</span>: <span class="ident">Sized</span> <span class="op">+</span> <span class="ident">private::Sealed</span> {
    <span class="doccomment">/// Use the specified function as the entry point of the executable object</span>
    <span class="doccomment">/// being defined.</span>
    <span class="kw">fn</span> <span class="ident">start</span>(<span class="self">self</span>, <span class="ident">start</span>: <span class="ident">Closure</span>) -&gt; <span class="self">Self</span>;
}

<span class="kw">mod</span> <span class="ident">private</span> {
    <span class="kw">use</span> <span class="kw">super</span>::<span class="kw-2">*</span>;

    <span class="kw">pub</span> <span class="kw">trait</span> <span class="ident">Sealed</span> {}

    <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>: <span class="ident">raw::KernelBase</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Sealed</span> <span class="kw">for</span> <span class="ident">kernel::task::TaskDefiner</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span> {}
    <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>: <span class="ident">raw::KernelInterruptLine</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Sealed</span>
        <span class="kw">for</span> <span class="ident">kernel::interrupt::InterruptHandlerDefiner</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span>
    {
    }
    <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>: <span class="ident">raw::KernelTimer</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Sealed</span> <span class="kw">for</span> <span class="ident">kernel::timer::TimerDefiner</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span> {}
}

<span class="kw">unsafe</span> <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>: <span class="ident">raw::KernelBase</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">ExecutableDefiner</span> <span class="kw">for</span> <span class="ident">kernel::task::TaskDefiner</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span> {
    <span class="kw">fn</span> <span class="ident">start</span>(<span class="self">self</span>, <span class="ident">start</span>: <span class="ident">Closure</span>) -&gt; <span class="self">Self</span> {
        <span class="self">self</span>.<span class="ident">start</span>(<span class="ident">start</span>)
    }
}

<span class="kw">unsafe</span> <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>: <span class="ident">raw::KernelInterruptLine</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">ExecutableDefiner</span>
    <span class="kw">for</span> <span class="ident">kernel::interrupt::InterruptHandlerDefiner</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span>
{
    <span class="kw">fn</span> <span class="ident">start</span>(<span class="self">self</span>, <span class="ident">start</span>: <span class="ident">Closure</span>) -&gt; <span class="self">Self</span> {
        <span class="self">self</span>.<span class="ident">start</span>(<span class="ident">start</span>)
    }
}

<span class="kw">unsafe</span> <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>: <span class="ident">raw::KernelTimer</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">ExecutableDefiner</span>
    <span class="kw">for</span> <span class="ident">kernel::timer::TimerDefiner</span><span class="op">&lt;</span><span class="ident">System</span><span class="op">&gt;</span>
{
    <span class="kw">fn</span> <span class="ident">start</span>(<span class="self">self</span>, <span class="ident">start</span>: <span class="ident">Closure</span>) -&gt; <span class="self">Self</span> {
        <span class="self">self</span>.<span class="ident">start</span>(<span class="ident">start</span>)
    }
}

<span class="comment">// TODO: This probably can be moved to `r3`</span>
<span class="doccomment">/// An extension trait for [`ExecutableDefiner`]. Provides a method to</span>
<span class="doccomment">/// attach an entry point with materialized [bindings][1].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: Bind</span>
<span class="kw">pub</span> <span class="kw">trait</span> <span class="ident">ExecutableDefinerExt</span> {
    <span class="doccomment">/// Use the specified function with dependency as the entry point of the</span>
    <span class="doccomment">/// executable object being defined.</span>
    <span class="kw">fn</span> <span class="ident">start_with_bind</span><span class="op">&lt;</span><span class="ident">Binder</span>, <span class="ident">Func</span>: ~<span class="kw">const</span> <span class="ident">FnBind</span><span class="op">&lt;</span><span class="ident">Binder</span>, <span class="ident">Output</span> <span class="op">=</span> ()<span class="op">&gt;</span><span class="op">&gt;</span>(
        <span class="self">self</span>,
        <span class="ident">binder</span>: <span class="ident">Binder</span>,
        <span class="ident">func</span>: <span class="ident">Func</span>,
    ) -&gt; <span class="self">Self</span>;
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>: ~<span class="kw">const</span> <span class="ident">ExecutableDefiner</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">ExecutableDefinerExt</span> <span class="kw">for</span> <span class="ident">T</span> {
    <span class="kw">fn</span> <span class="ident">start_with_bind</span><span class="op">&lt;</span><span class="ident">Binder</span>, <span class="ident">Func</span>: ~<span class="kw">const</span> <span class="ident">FnBind</span><span class="op">&lt;</span><span class="ident">Binder</span>, <span class="ident">Output</span> <span class="op">=</span> ()<span class="op">&gt;</span><span class="op">&gt;</span>(
        <span class="self">self</span>,
        <span class="ident">binder</span>: <span class="ident">Binder</span>,
        <span class="ident">func</span>: <span class="ident">Func</span>,
    ) -&gt; <span class="self">Self</span> {
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">ctx</span> <span class="op">=</span> <span class="ident">CfgBindCtx</span> {
            <span class="ident">_phantom</span>: <span class="kw-2">&amp;</span>(),
            <span class="ident">usage</span>: <span class="ident">BindUsage::Executable</span>,
        };
        <span class="self">self</span>.<span class="ident">start</span>(<span class="ident">Closure::from_fn_const</span>(<span class="ident">func</span>.<span class="ident">bind</span>(<span class="ident">binder</span>, <span class="kw-2">&amp;mut</span> <span class="ident">ctx</span>)))
    }
}

<span class="comment">// ----------------------------------------------------------------------------</span>

<span class="doccomment">/// A trait for closures that can receive [bindings][1] materialized through</span>
<span class="doccomment">/// specific [binders][4] (`Binder`).</span>
<span class="doccomment">///</span>
<span class="doccomment">/// `FnBind&lt;(B0, B1, ...)&gt;` is implemented for `impl for&lt;&#39;call&gt;</span>
<span class="doccomment">/// FnOnce(M0&lt;&#39;call&gt;, M1&lt;&#39;call&gt;, ...) + Copy + Send + &#39;static`, where `Mn&lt;&#39;call&gt;</span>
<span class="doccomment">/// == Bn::`[`Runtime`][2]`::`[`Target`][3]`&lt;&#39;call&gt;` (`Bn`&#39;s materialized form).</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: Bind</span>
<span class="doccomment">/// [2]: Binder::Runtime</span>
<span class="doccomment">/// [3]: RuntimeBinder::Target</span>
<span class="doccomment">/// [4]: Binder</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is covered by the application-side API stability guarantee with</span>
<span class="doccomment">/// the exception of its members, which are implementation details.</span>
<span class="kw">pub</span> <span class="kw">trait</span> <span class="ident">FnBind</span><span class="op">&lt;</span><span class="ident">Binder</span><span class="op">&gt;</span> {
    <span class="kw">type</span> <span class="ident">Output</span>: <span class="lifetime">&#39;static</span>;
    <span class="kw">type</span> <span class="ident">BoundFn</span>: <span class="ident">FnOnce</span>() -&gt; <span class="ident"><span class="self">Self</span>::Output</span> <span class="op">+</span> <span class="ident">Copy</span> <span class="op">+</span> <span class="ident">Send</span> <span class="op">+</span> <span class="lifetime">&#39;static</span>;

    <span class="kw">fn</span> <span class="ident">bind</span>(<span class="self">self</span>, <span class="ident">binder</span>: <span class="ident">Binder</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) -&gt; <span class="ident"><span class="self">Self</span>::BoundFn</span>;
}

<span class="macro">macro_rules!</span> <span class="ident">impl_fn_bind</span> {
    ( @<span class="ident">start</span> $(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">x</span>:<span class="ident">tt</span>)<span class="op">*</span> ) =&gt; {
        <span class="macro">impl_fn_bind!</span> { @<span class="ident">iter</span> [] [$(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">x</span>)<span class="kw-2">*</span>] }
    };

    <span class="comment">// inductive case</span>
    ( @<span class="ident">iter</span>
        [$((<span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>:<span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>:<span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">fieldI</span>:<span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>:<span class="ident">tt</span>))<span class="kw-2">*</span>]
        [<span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_head</span>:<span class="ident">tt</span> $(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_tail</span>:<span class="ident">tt</span>)<span class="kw-2">*</span>]
    ) =&gt; {
        <span class="macro">impl_fn_bind!</span> { @<span class="ident">iter</span> [$((<span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">fieldI</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>))<span class="op">*</span> <span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_head</span>] [$(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_tail</span>)<span class="kw-2">*</span>] }

        <span class="kw">const</span> <span class="kw">_</span>: () <span class="op">=</span> {
            <span class="kw">impl</span><span class="op">&lt;</span>
                <span class="ident">T</span>,
                <span class="ident">Output</span>,
                $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, )<span class="op">*</span>
            <span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">FnBind</span><span class="op">&lt;</span>( $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>, )<span class="op">*</span> )<span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">T</span>
            <span class="kw">where</span>
                $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>: ~<span class="kw">const</span> <span class="ident">Binder</span><span class="op">&lt;</span><span class="ident">Runtime</span> <span class="op">=</span> <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span><span class="op">&gt;</span>, )<span class="op">*</span>
                $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>: <span class="ident">RuntimeBinder</span>, )<span class="op">*</span>
                <span class="ident">T</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>($( <span class="op">&lt;</span><span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI::Runtime</span> <span class="kw">as</span> <span class="ident">RuntimeBinder</span><span class="op">&gt;</span><span class="ident">::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>, )<span class="kw-2">*</span>)
                    -&gt; <span class="ident">Output</span> <span class="op">+</span> <span class="ident">Copy</span> <span class="op">+</span> <span class="ident">Send</span> <span class="op">+</span> <span class="lifetime">&#39;static</span>,
                <span class="ident">Output</span>: <span class="lifetime">&#39;static</span>,
            {
                <span class="kw">type</span> <span class="ident">Output</span> <span class="op">=</span> <span class="ident">Output</span>;

                <span class="kw">type</span> <span class="ident">BoundFn</span> <span class="op">=</span> <span class="ident">BoundFn</span><span class="op">&lt;</span><span class="ident">T</span>, $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, )<span class="kw-2">*</span><span class="op">&gt;</span>;

                <span class="kw">fn</span> <span class="ident">bind</span>(
                    <span class="self">self</span>,
                    <span class="ident">binder</span>: ( $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>, )<span class="op">*</span> ),
                    <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>,
                ) -&gt; <span class="ident"><span class="self">Self</span>::BoundFn</span> {
                    <span class="ident">Binder::register_dependency</span>(<span class="kw-2">&amp;</span><span class="ident">binder</span>, <span class="ident">ctx</span>);

                    <span class="kw">let</span> <span class="ident">intermediate</span> <span class="op">=</span> <span class="ident">Binder::into_runtime_binder</span>(<span class="ident">binder</span>);
                    <span class="ident">BoundFn</span> {
                        <span class="ident">func</span>: <span class="self">self</span>,
                        <span class="ident">runtime_binders</span>: <span class="ident">intermediate</span>,
                    }
                }
            }

            <span class="comment">// This opaque type must be defined outside the above `impl` to</span>
            <span class="comment">// prevent the unintended capturing of `$BinderI`.</span>
            <span class="comment">// [ref:opaque_type_extraneous_capture]</span>
            <span class="comment">// type BoundFn&lt;T, Output, $( $RuntimeBinderI, )*&gt;</span>
            <span class="comment">// where</span>
            <span class="comment">//     $( $RuntimeBinderI: RuntimeBinder, )*</span>
            <span class="comment">//     T: for&lt;&#39;call&gt; FnOnce($( $RuntimeBinderI::Target&lt;&#39;call&gt;, )*)</span>
            <span class="comment">//         -&gt; Output + Copy + Send + &#39;static,</span>
            <span class="comment">//  = impl FnOnce() -&gt; Output + Copy + Send + &#39;static;</span>

            <span class="comment">// FIXME: This is supposed to be a TAIT like the one above, but</span>
            <span class="comment">// [ref:rust_99793_tait] prevents that</span>
            <span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Copy</span>, <span class="ident">Clone</span>)]</span>
            <span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BoundFn</span><span class="op">&lt;</span><span class="ident">T</span>, $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, )<span class="kw-2">*</span><span class="op">&gt;</span> {
                <span class="ident">func</span>: <span class="ident">T</span>,
                <span class="ident">runtime_binders</span>: ($( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, )<span class="kw-2">*</span>),
            }

            <span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">Output</span>, $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, )<span class="kw-2">*</span><span class="op">&gt;</span> <span class="ident">FnOnce</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">BoundFn</span><span class="op">&lt;</span><span class="ident">T</span>, $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, )<span class="kw-2">*</span><span class="op">&gt;</span>
            <span class="kw">where</span>
                $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>: <span class="ident">RuntimeBinder</span>, )<span class="op">*</span>
                <span class="ident">T</span>: <span class="kw">for</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="ident">FnOnce</span>($( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>, )<span class="kw-2">*</span>) -&gt; <span class="ident">Output</span>,
            {
                <span class="kw">type</span> <span class="ident">Output</span> <span class="op">=</span> <span class="ident">Output</span>;

                <span class="attribute">#[<span class="ident">inline</span>]</span>
                <span class="kw">extern</span> <span class="string">&quot;rust-call&quot;</span> <span class="kw">fn</span> <span class="ident">call_once</span>(<span class="self">self</span>, (): ()) -&gt; <span class="ident">Output</span> {
                    <span class="comment">// Safety: `runtime_binders` was created by the corresponding</span>
                    <span class="comment">// type&#39;s `into_runtime_binder` method.</span>
                    <span class="comment">// `CfgBindRegistry::finalize` checks that the borrowing</span>
                    <span class="comment">// rules regarding the materialization output are observed.</span>
                    <span class="comment">// If the check fails, so does the compilation, and this</span>
                    <span class="comment">// runtime code will never be executed.</span>
                    <span class="kw">let</span> ($( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">fieldI</span>, )<span class="kw-2">*</span>) <span class="op">=</span> <span class="kw">unsafe</span> {
                        <span class="op">&lt;</span>( $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, )<span class="op">*</span> ) <span class="kw">as</span> <span class="ident">RuntimeBinder</span><span class="op">&gt;</span><span class="ident">::materialize</span>(<span class="self">self</span>.<span class="ident">runtime_binders</span>)
                    };
                    (<span class="self">self</span>.<span class="ident">func</span>)($( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">fieldI</span>, )<span class="kw-2">*</span>)
                }
            }
        }; <span class="comment">// const _</span>
    }; <span class="comment">// end of macro arm</span>

    <span class="comment">// base case</span>
    ( @<span class="ident">iter</span> [$(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">_discard</span>:<span class="ident">tt</span>)<span class="kw-2">*</span>] [] ) =&gt; {}
}

<span class="macro">seq_macro::seq!</span>(<span class="ident">I</span> <span class="kw">in</span> <span class="number">0</span>..<span class="number">16</span> { <span class="macro">impl_fn_bind!</span> { @<span class="ident">start</span> #( (<span class="ident">Binder</span>~<span class="ident">I</span>, <span class="ident">RuntimeBinder</span>~<span class="ident">I</span>, <span class="ident">field</span>~<span class="ident">I</span>, <span class="ident">I</span>) )<span class="op">*</span> } });

<span class="doccomment">/// An uninhabited [`FnBind`] implementation.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is covered by the application-side API stability guarantee.</span>
<span class="attribute">#[<span class="ident">doc</span>(<span class="ident">hidden</span>)]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Clone</span>, <span class="ident">Copy</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">FnBindNever</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span> {
    <span class="ident">_phantom</span>: <span class="ident">PhantomData</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>,
    <span class="ident">uninhabited</span>: <span class="ident">core::convert::Infallible</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>: <span class="lifetime">&#39;static</span>, <span class="ident">Binder</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">FnBind</span><span class="op">&lt;</span><span class="ident">Binder</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">FnBindNever</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">Binder</span>: ~<span class="kw">const</span> <span class="ident"><span class="self">self</span>::Binder</span>,
{
    <span class="kw">type</span> <span class="ident">Output</span> <span class="op">=</span> <span class="ident">T</span>;
    <span class="kw">type</span> <span class="ident">BoundFn</span> <span class="op">=</span> <span class="kw">fn</span>() -&gt; <span class="ident">T</span>; <span class="comment">// FIXME: Make this uninhabited</span>

    <span class="kw">fn</span> <span class="ident">bind</span>(<span class="self">self</span>, <span class="kw">_</span>: <span class="ident">Binder</span>, <span class="kw">_</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) -&gt; <span class="ident"><span class="self">Self</span>::BoundFn</span> {
        <span class="kw">match</span> <span class="self">self</span>.<span class="ident">uninhabited</span> {}
    }
}

<span class="doccomment">/// Apply a function to an `impl `[`FnBind`][]`&lt;_&gt;`&#39;s output.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Example</span>
<span class="doccomment">///</span>
<span class="doccomment">/// ```rust</span>
<span class="doccomment">/// #![feature(const_trait_impl)]</span>
<span class="doccomment">/// #![feature(const_mut_refs)]</span>
<span class="doccomment">/// use core::cell::UnsafeCell;</span>
<span class="doccomment">/// use r3_core::{kernel::{cfg, traits}, bind::{Bind, FnBind, fn_bind_map}};</span>
<span class="doccomment">///</span>
<span class="doccomment">/// /// Like `r3::bind::bind` but wraps the output in `UnsafeCell`</span>
<span class="doccomment">/// const fn unsafe_cell_bind&lt;&#39;pool, C, Binder, Func, T&gt;(</span>
<span class="doccomment">///     cfg: &amp;mut cfg::Cfg&lt;&#39;pool, C&gt;,</span>
<span class="doccomment">///     binder: Binder,</span>
<span class="doccomment">///     func: Func,</span>
<span class="doccomment">/// ) -&gt; Bind&lt;&#39;pool, C::System, UnsafeCell&lt;T&gt;&gt;</span>
<span class="doccomment">/// where</span>
<span class="doccomment">///     C: ~const traits::CfgBase,</span>
<span class="doccomment">///     C::System: traits::KernelBase + traits::KernelStatic,</span>
<span class="doccomment">///     Func: ~const FnBind&lt;Binder, Output = T&gt;,</span>
<span class="doccomment">///     T: &#39;static,</span>
<span class="doccomment">/// {</span>
<span class="doccomment">///     Bind::define()</span>
<span class="doccomment">///         // Apply `UnsafeCell::new` on `func`&#39;s output</span>
<span class="doccomment">///         .init_with_bind(binder, fn_bind_map(func, UnsafeCell::new))</span>
<span class="doccomment">///         .finish(cfg)</span>
<span class="doccomment">/// }</span>
<span class="doccomment">/// ```</span>
<span class="kw">pub</span> <span class="kw">const</span> <span class="kw">fn</span> <span class="ident">fn_bind_map</span><span class="op">&lt;</span><span class="ident">FnBind</span>, <span class="ident">Mapper</span><span class="op">&gt;</span>(
    <span class="ident">inner</span>: <span class="ident">FnBind</span>,
    <span class="ident">mapper</span>: <span class="ident">Mapper</span>,
) -&gt; <span class="ident">FnBindMap</span><span class="op">&lt;</span><span class="ident">FnBind</span>, <span class="ident">Mapper</span><span class="op">&gt;</span> {
    <span class="ident">FnBindMap</span> { <span class="ident">inner</span>, <span class="ident">mapper</span> }
}

<span class="doccomment">/// Applies a function to a [`FnBind`][]&#39;s output.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// Created by [`fn_bind_map`][].</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">FnBindMap</span><span class="op">&lt;</span><span class="ident">Inner</span>, <span class="ident">Mapper</span><span class="op">&gt;</span> {
    <span class="ident">inner</span>: <span class="ident">Inner</span>,
    <span class="ident">mapper</span>: <span class="ident">Mapper</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">Binder</span>, <span class="ident">Inner</span>, <span class="ident">InnerBoundFn</span>, <span class="ident">Output</span>, <span class="ident">Mapper</span>, <span class="ident">NewOutput</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">FnBind</span><span class="op">&lt;</span><span class="ident">Binder</span><span class="op">&gt;</span>
    <span class="kw">for</span> <span class="ident">FnBindMap</span><span class="op">&lt;</span><span class="ident">Inner</span>, <span class="ident">Mapper</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">Inner</span>: ~<span class="kw">const</span> <span class="ident">FnBind</span><span class="op">&lt;</span><span class="ident">Binder</span>, <span class="ident">Output</span> <span class="op">=</span> <span class="ident">Output</span>, <span class="ident">BoundFn</span> <span class="op">=</span> <span class="ident">InnerBoundFn</span><span class="op">&gt;</span>,
    <span class="ident">InnerBoundFn</span>: <span class="ident">FnOnce</span>() -&gt; <span class="ident">Output</span> <span class="op">+</span> <span class="ident">Copy</span> <span class="op">+</span> <span class="ident">Send</span> <span class="op">+</span> <span class="lifetime">&#39;static</span>,
    <span class="ident">Output</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">Mapper</span>: <span class="ident">FnOnce</span>(<span class="ident">Output</span>) -&gt; <span class="ident">NewOutput</span> <span class="op">+</span> <span class="ident">Copy</span> <span class="op">+</span> <span class="ident">Send</span> <span class="op">+</span> <span class="lifetime">&#39;static</span>,
    <span class="ident">NewOutput</span>: <span class="lifetime">&#39;static</span>,
{
    <span class="kw">type</span> <span class="ident">Output</span> <span class="op">=</span> <span class="ident">NewOutput</span>;

    <span class="kw">type</span> <span class="ident">BoundFn</span> <span class="op">=</span> <span class="ident">MappedBoundFn</span><span class="op">&lt;</span><span class="ident">InnerBoundFn</span>, <span class="ident">Mapper</span><span class="op">&gt;</span>;

    <span class="kw">fn</span> <span class="ident">bind</span>(<span class="self">self</span>, <span class="ident">binder</span>: <span class="ident">Binder</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) -&gt; <span class="ident"><span class="self">Self</span>::BoundFn</span> {
        <span class="ident">MappedBoundFn</span> {
            <span class="ident">inner_bound_fn</span>: <span class="self">self</span>.<span class="ident">inner</span>.<span class="ident">bind</span>(<span class="ident">binder</span>, <span class="ident">ctx</span>),
            <span class="ident">mapper</span>: <span class="self">self</span>.<span class="ident">mapper</span>,
        }
    }
}

<span class="comment">// // This opaque type must be defined outside this trait to</span>
<span class="comment">// // prevent the unintended capturing of `Binder`.</span>
<span class="comment">// // [ref:opaque_type_extraneous_capture]</span>
<span class="comment">// type MappedBoundFn&lt;InnerBoundFn, Output, Mapper, NewOutput&gt;</span>
<span class="comment">// where</span>
<span class="comment">//     InnerBoundFn: FnOnce() -&gt; Output + Copy + Send + &#39;static,</span>
<span class="comment">//     Mapper: FnOnce(Output) -&gt; NewOutput + Copy + Send + &#39;static,</span>
<span class="comment">// = impl FnOnce() -&gt; NewOutput + Copy + Send + &#39;static;</span>

<span class="comment">// FIXME: This is supposed to be a TAIT like the one above, but</span>
<span class="comment">// [ref:rust_99793_tait] prevents that</span>
<span class="attribute">#[<span class="ident">doc</span>(<span class="ident">hidden</span>)]</span>
<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Copy</span>, <span class="ident">Clone</span>)]</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">MappedBoundFn</span><span class="op">&lt;</span><span class="ident">InnerBoundFn</span>, <span class="ident">Mapper</span><span class="op">&gt;</span> {
    <span class="ident">inner_bound_fn</span>: <span class="ident">InnerBoundFn</span>,
    <span class="ident">mapper</span>: <span class="ident">Mapper</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">InnerBoundFn</span>, <span class="ident">Output</span>, <span class="ident">Mapper</span>, <span class="ident">NewOutput</span><span class="op">&gt;</span> <span class="ident">FnOnce</span><span class="op">&lt;</span>()<span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">MappedBoundFn</span><span class="op">&lt;</span><span class="ident">InnerBoundFn</span>, <span class="ident">Mapper</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">InnerBoundFn</span>: <span class="ident">FnOnce</span>() -&gt; <span class="ident">Output</span> <span class="op">+</span> <span class="ident">Copy</span> <span class="op">+</span> <span class="ident">Send</span> <span class="op">+</span> <span class="lifetime">&#39;static</span>,
    <span class="ident">Mapper</span>: <span class="ident">FnOnce</span>(<span class="ident">Output</span>) -&gt; <span class="ident">NewOutput</span> <span class="op">+</span> <span class="ident">Copy</span> <span class="op">+</span> <span class="ident">Send</span> <span class="op">+</span> <span class="lifetime">&#39;static</span>,
{
    <span class="kw">type</span> <span class="ident">Output</span> <span class="op">=</span> <span class="ident">NewOutput</span>;

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">extern</span> <span class="string">&quot;rust-call&quot;</span> <span class="kw">fn</span> <span class="ident">call_once</span>(<span class="self">self</span>, (): ()) -&gt; <span class="ident"><span class="self">Self</span>::Output</span> {
        (<span class="self">self</span>.<span class="ident">mapper</span>)((<span class="self">self</span>.<span class="ident">inner_bound_fn</span>)())
    }
}

<span class="comment">// Binder traits</span>
<span class="comment">// ----------------------------------------------------------------------------</span>

<span class="doccomment">/// Represents a *binder*, which represents a specific way to access the</span>
<span class="doccomment">/// contents of a [binding][1] from a runtime function.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// See [the module-level documentation][2] for more.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is covered by the application-side API stability guarantee with</span>
<span class="doccomment">/// a few exceptions, which are documented on a per-item basis.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// [1]: Bind</span>
<span class="doccomment">/// [2]: index.html#binders</span>
<span class="kw">pub</span> <span class="kw">trait</span> <span class="ident">Binder</span> {
    <span class="doccomment">/// The runtime representation of `Self`.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Stability</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// This method is unstable.</span>
    <span class="kw">type</span> <span class="ident">Runtime</span>: <span class="ident">RuntimeBinder</span>;

    <span class="doccomment">/// Define a binding dependency in `CfgBindCtx::bind_registry`.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Stability</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// This method is unstable.</span>
    <span class="kw">fn</span> <span class="ident">register_dependency</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>);

    <span class="doccomment">/// Convert `self` to the runtime representation ([`RuntimeBinder`][]).</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Stability</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// This method is unstable.</span>
    <span class="kw">fn</span> <span class="ident">into_runtime_binder</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Runtime</span>;
}

<span class="doccomment">/// Unstable. The runtime representation of [`Binder`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait signifies the following properties regarding an implementing</span>
<span class="doccomment">/// type:</span>
<span class="doccomment">///</span>
<span class="doccomment">///  - `self` can be &quot;materialized&quot; as `Self::Target&lt;&#39;call&gt;` at runtime.</span>
<span class="doccomment">///</span>
<span class="doccomment">///  - `&#39;call` represets the duration during which `Self::Target` is used. If</span>
<span class="doccomment">///    `Self::Target&lt;&#39;call&gt;` is a reference, its lifetime parameter may be</span>
<span class="doccomment">///    bound to `&#39;call`. Some binder types don&#39;t require this.</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is unstable.</span>
<span class="kw">pub</span> <span class="kw">trait</span> <span class="ident">RuntimeBinder</span>: <span class="ident">Send</span> <span class="op">+</span> <span class="ident">Copy</span> <span class="op">+</span> <span class="lifetime">&#39;static</span> {
    <span class="doccomment">/// The materialized form.</span>
    <span class="kw">type</span> <span class="ident">Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>;

    <span class="doccomment">/// Construct a target object at runtime, using the intermediate product</span>
    <span class="doccomment">/// constructed by [`Binder::into_runtime_binder`].</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// # Safety</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// `intermediate` must have been constructed by</span>
    <span class="doccomment">/// `&lt;Self as Binder&gt;::into_runtime_binder`.</span>
    <span class="doccomment">///</span>
    <span class="doccomment">/// The caller must uphold that `Self::Target` is safe to exist. (The</span>
    <span class="doccomment">/// configuration system is reponsible for enforcing this property.)</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">materialize</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>;
}

<span class="doccomment">/// Unstable. The runtime representation of [`BindTake`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is unstable.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">RuntimeBindTake</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Clone</span> <span class="kw">for</span> <span class="ident">RuntimeBindTake</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">fn</span> <span class="ident">clone</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="self">Self</span> {
        <span class="kw-2">*</span><span class="self">self</span>
    }
}
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Copy</span> <span class="kw">for</span> <span class="ident">RuntimeBindTake</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {}

<span class="doccomment">/// Materializes `BindTake&lt;System, T&gt;` as `T`.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Binder</span> <span class="kw">for</span> <span class="ident">BindTake</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Runtime</span> <span class="op">=</span> <span class="ident">RuntimeBindTake</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>;

    <span class="kw">fn</span> <span class="ident">register_dependency</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) {
        <span class="kw">if</span> <span class="macro">matches!</span>(<span class="ident">ctx</span>.<span class="ident">usage</span>, <span class="ident">BindUsage::Executable</span>) {
            <span class="macro">panic!</span>(
                <span class="string">&quot;an executable object can not consume `BindTake` because the \
                executable object may run for multiple times, but the binding \
                value can be moved out only once&quot;</span>
            );
        }

        <span class="kw">let</span> <span class="ident">Bind</span> {
            <span class="ident">bind_registry</span>,
            <span class="ident">bind_i</span>,
            ..
        } <span class="op">=</span> <span class="self">self</span>.<span class="number">0</span>;
        <span class="ident">bind_registry</span>.<span class="ident">borrow_mut</span>().<span class="ident">binds</span>[<span class="ident">bind_i</span>]
            .<span class="ident">users</span>
            .<span class="ident">push</span>((<span class="ident">ctx</span>.<span class="ident">usage</span>, <span class="ident">BindBorrowType::Take</span>));
    }

    <span class="kw">fn</span> <span class="ident">into_runtime_binder</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Runtime</span> {
        <span class="ident">RuntimeBindTake</span>(<span class="self">self</span>.<span class="number">0</span>.<span class="ident">hunk</span>)
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="ident">RuntimeBinder</span> <span class="kw">for</span> <span class="ident">RuntimeBindTake</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">T</span>;

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">materialize</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> {
        <span class="kw">unsafe</span> { <span class="ident">BindHunk::as_ref</span>(<span class="self">self</span>.<span class="number">0</span>).<span class="number">0</span>.<span class="ident">get</span>().<span class="ident">read</span>().<span class="ident">assume_init</span>() }
    }
}

<span class="doccomment">/// Unstable. The runtime representation of [`BindTakeMut`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is unstable.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">RuntimeBindTakeMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Clone</span> <span class="kw">for</span> <span class="ident">RuntimeBindTakeMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">fn</span> <span class="ident">clone</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="self">Self</span> {
        <span class="kw-2">*</span><span class="self">self</span>
    }
}
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Copy</span> <span class="kw">for</span> <span class="ident">RuntimeBindTakeMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {}

<span class="doccomment">/// Materializes `BindTakeMut&lt;System, T&gt;` as `&amp;&#39;static mut T`.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Binder</span> <span class="kw">for</span> <span class="ident">BindTakeMut</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Runtime</span> <span class="op">=</span> <span class="ident">RuntimeBindTakeMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>;

    <span class="kw">fn</span> <span class="ident">register_dependency</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) {
        <span class="kw">if</span> <span class="macro">matches!</span>(<span class="ident">ctx</span>.<span class="ident">usage</span>, <span class="ident">BindUsage::Executable</span>) {
            <span class="macro">panic!</span>(
                <span class="string">&quot;an executable object can not consume `BindTakeMut` because the \
                executable object may run for multiple times, but multiple \
                mutable borrows of the binding are not allowed to exist \
                simultaneously&quot;</span>
            );
        }

        <span class="kw">let</span> <span class="ident">Bind</span> {
            <span class="ident">bind_registry</span>,
            <span class="ident">bind_i</span>,
            ..
        } <span class="op">=</span> <span class="self">self</span>.<span class="number">0</span>;
        <span class="ident">bind_registry</span>.<span class="ident">borrow_mut</span>().<span class="ident">binds</span>[<span class="ident">bind_i</span>]
            .<span class="ident">users</span>
            .<span class="ident">push</span>((<span class="ident">ctx</span>.<span class="ident">usage</span>, <span class="ident">BindBorrowType::TakeMut</span>));
    }

    <span class="kw">fn</span> <span class="ident">into_runtime_binder</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Runtime</span> {
        <span class="ident">RuntimeBindTakeMut</span>(<span class="self">self</span>.<span class="number">0</span>.<span class="ident">hunk</span>)
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="ident">RuntimeBinder</span> <span class="kw">for</span> <span class="ident">RuntimeBindTakeMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="lifetime">&#39;static</span> <span class="kw-2">mut</span> <span class="ident">T</span>;

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">materialize</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> {
        <span class="kw">unsafe</span> { <span class="ident">BindHunk::as_ref</span>(<span class="self">self</span>.<span class="number">0</span>).<span class="ident">assume_init_mut</span>() }
    }
}

<span class="doccomment">/// Unstable. The runtime representation of [`BindTakeRef`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is unstable.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">RuntimeBindTakeRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Clone</span> <span class="kw">for</span> <span class="ident">RuntimeBindTakeRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">fn</span> <span class="ident">clone</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="self">Self</span> {
        <span class="kw-2">*</span><span class="self">self</span>
    }
}
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Copy</span> <span class="kw">for</span> <span class="ident">RuntimeBindTakeRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {}

<span class="doccomment">/// Materializes `BindTakeRef&lt;System, T&gt;` as `&amp;&#39;static T`.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Binder</span> <span class="kw">for</span> <span class="ident">BindTakeRef</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span> <span class="op">+</span> <span class="ident">Sync</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Runtime</span> <span class="op">=</span> <span class="ident">RuntimeBindTakeRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>;

    <span class="kw">fn</span> <span class="ident">register_dependency</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) {
        <span class="kw">let</span> <span class="ident">Bind</span> {
            <span class="ident">bind_registry</span>,
            <span class="ident">bind_i</span>,
            ..
        } <span class="op">=</span> <span class="self">self</span>.<span class="number">0</span>;
        <span class="ident">bind_registry</span>.<span class="ident">borrow_mut</span>().<span class="ident">binds</span>[<span class="ident">bind_i</span>]
            .<span class="ident">users</span>
            .<span class="ident">push</span>((<span class="ident">ctx</span>.<span class="ident">usage</span>, <span class="ident">BindBorrowType::TakeRef</span>));
    }

    <span class="kw">fn</span> <span class="ident">into_runtime_binder</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Runtime</span> {
        <span class="ident">RuntimeBindTakeRef</span>(<span class="self">self</span>.<span class="number">0</span>.<span class="ident">hunk</span>)
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="ident">RuntimeBinder</span> <span class="kw">for</span> <span class="ident">RuntimeBindTakeRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="lifetime">&#39;static</span> <span class="ident">T</span>;

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">materialize</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> {
        <span class="kw">unsafe</span> { <span class="ident">BindHunk::as_ref</span>(<span class="self">self</span>.<span class="number">0</span>).<span class="ident">assume_init_ref</span>() }
    }
}

<span class="doccomment">/// Unstable. The runtime representation of [`BindBorrow`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is unstable.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">RuntimeBindBorrow</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Clone</span> <span class="kw">for</span> <span class="ident">RuntimeBindBorrow</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">fn</span> <span class="ident">clone</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="self">Self</span> {
        <span class="kw-2">*</span><span class="self">self</span>
    }
}
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Copy</span> <span class="kw">for</span> <span class="ident">RuntimeBindBorrow</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {}

<span class="doccomment">/// Materializes `BindBorrow&lt;System, T&gt;` as `&amp;&#39;call T`.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Binder</span> <span class="kw">for</span> <span class="ident">BindBorrow</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Runtime</span> <span class="op">=</span> <span class="ident">RuntimeBindBorrow</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>;

    <span class="kw">fn</span> <span class="ident">register_dependency</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) {
        <span class="kw">let</span> <span class="ident">Bind</span> {
            <span class="ident">bind_registry</span>,
            <span class="ident">bind_i</span>,
            ..
        } <span class="op">=</span> <span class="self">self</span>.<span class="number">0</span>;

        <span class="kw">let</span> <span class="ident">borrow_type</span> <span class="op">=</span> <span class="kw">match</span> <span class="ident">ctx</span>.<span class="ident">usage</span> {
            <span class="ident">BindUsage::Bind</span>(<span class="kw">_</span>) =&gt; <span class="ident">BindBorrowType::Borrow</span>,
            <span class="ident">BindUsage::Executable</span> =&gt; <span class="ident">BindBorrowType::TakeRef</span>,
        };

        <span class="ident">bind_registry</span>.<span class="ident">borrow_mut</span>().<span class="ident">binds</span>[<span class="ident">bind_i</span>]
            .<span class="ident">users</span>
            .<span class="ident">push</span>((<span class="ident">ctx</span>.<span class="ident">usage</span>, <span class="ident">borrow_type</span>));
    }

    <span class="kw">fn</span> <span class="ident">into_runtime_binder</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Runtime</span> {
        <span class="ident">RuntimeBindBorrow</span>(<span class="self">self</span>.<span class="number">0</span>.<span class="ident">hunk</span>)
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="ident">RuntimeBinder</span> <span class="kw">for</span> <span class="ident">RuntimeBindBorrow</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="lifetime">&#39;call</span> <span class="ident">T</span>;

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">materialize</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> {
        <span class="kw">unsafe</span> { <span class="ident">BindHunk::as_ref</span>(<span class="self">self</span>.<span class="number">0</span>).<span class="ident">assume_init_ref</span>() }
    }
}

<span class="doccomment">/// Unstable. The runtime representation of [`BindBorrowMut`][].</span>
<span class="doccomment">///</span>
<span class="doccomment">/// # Stability</span>
<span class="doccomment">///</span>
<span class="doccomment">/// This trait is unstable.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">RuntimeBindBorrowMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>(<span class="ident">BindHunk</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>);

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Clone</span> <span class="kw">for</span> <span class="ident">RuntimeBindBorrowMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {
    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">fn</span> <span class="ident">clone</span>(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="self">Self</span> {
        <span class="kw-2">*</span><span class="self">self</span>
    }
}
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Copy</span> <span class="kw">for</span> <span class="ident">RuntimeBindBorrowMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span> {}

<span class="doccomment">/// Materializes `BindBorrowMut&lt;System, T&gt;` as `&amp;&#39;call mut T`.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Binder</span> <span class="kw">for</span> <span class="ident">BindBorrowMut</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span>, <span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Runtime</span> <span class="op">=</span> <span class="ident">RuntimeBindBorrowMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>;

    <span class="kw">fn</span> <span class="ident">register_dependency</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) {
        <span class="kw">let</span> <span class="ident">Bind</span> {
            <span class="ident">bind_registry</span>,
            <span class="ident">bind_i</span>,
            ..
        } <span class="op">=</span> <span class="self">self</span>.<span class="number">0</span>;

        <span class="kw">let</span> <span class="ident">borrow_type</span> <span class="op">=</span> <span class="kw">match</span> <span class="ident">ctx</span>.<span class="ident">usage</span> {
            <span class="ident">BindUsage::Bind</span>(<span class="kw">_</span>) =&gt; <span class="ident">BindBorrowType::BorrowMut</span>,
            <span class="ident">BindUsage::Executable</span> =&gt; <span class="ident">BindBorrowType::TakeMut</span>,
        };

        <span class="ident">bind_registry</span>.<span class="ident">borrow_mut</span>().<span class="ident">binds</span>[<span class="ident">bind_i</span>]
            .<span class="ident">users</span>
            .<span class="ident">push</span>((<span class="ident">ctx</span>.<span class="ident">usage</span>, <span class="ident">borrow_type</span>));
    }

    <span class="kw">fn</span> <span class="ident">into_runtime_binder</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Runtime</span> {
        <span class="ident">RuntimeBindBorrowMut</span>(<span class="self">self</span>.<span class="number">0</span>.<span class="ident">hunk</span>)
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="ident">RuntimeBinder</span> <span class="kw">for</span> <span class="ident">RuntimeBindBorrowMut</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="lifetime">&#39;call</span> <span class="kw-2">mut</span> <span class="ident">T</span>;

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">materialize</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> {
        <span class="kw">unsafe</span> { <span class="ident">BindHunk::as_ref</span>(<span class="self">self</span>.<span class="number">0</span>).<span class="ident">assume_init_mut</span>() }
    }
}

<span class="doccomment">/// Materializes `BindRef&lt;System, T&gt;` as `&amp;&#39;static T`. Can only be consumed by</span>
<span class="doccomment">/// executables and not by bindings.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Binder</span> <span class="kw">for</span> <span class="ident">BindRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Runtime</span> <span class="op">=</span> <span class="self">Self</span>;

    <span class="kw">fn</span> <span class="ident">register_dependency</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) {
        <span class="kw">match</span> <span class="ident">ctx</span>.<span class="ident">usage</span> {
            <span class="ident">BindUsage::Executable</span> =&gt; {
                <span class="comment">// Already registered by the call to `Bind::as_ref` that created</span>
                <span class="comment">// `*self`</span>
            }
            <span class="ident">BindUsage::Bind</span>(<span class="kw">_</span>) =&gt; {
                <span class="comment">// `BindTable` is only safely available for executables</span>
                <span class="macro">panic!</span>(
                    <span class="string">&quot;`BindRef` can not be consumed by a binding producer; \
                    consider using `BindTakeRef` instead&quot;</span>
                );
            }
        }
    }

    <span class="kw">fn</span> <span class="ident">into_runtime_binder</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Runtime</span> {
        <span class="self">self</span>
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">T</span>, <span class="ident">System</span><span class="op">&gt;</span> <span class="ident">RuntimeBinder</span> <span class="kw">for</span> <span class="ident">BindRef</span><span class="op">&lt;</span><span class="ident">System</span>, <span class="ident">T</span><span class="op">&gt;</span>
<span class="kw">where</span>
    <span class="ident">T</span>: <span class="lifetime">&#39;static</span>,
    <span class="ident">System</span>: <span class="ident">raw::KernelBase</span> <span class="op">+</span> <span class="ident">cfg::KernelStatic</span>,
{
    <span class="kw">type</span> <span class="ident">Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="lifetime">&#39;static</span> <span class="ident">T</span>;

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">materialize</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> {
        <span class="kw">unsafe</span> { <span class="kw-2">&amp;</span><span class="ident">BindTable::get_unchecked</span>()[<span class="self">self</span>] }
    }
}

<span class="macro">macro_rules!</span> <span class="ident">impl_binder_on_tuples</span> {
    ( @<span class="ident">start</span> $(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">x</span>:<span class="ident">tt</span>)<span class="op">*</span> ) =&gt; {
        <span class="macro">impl_binder_on_tuples!</span> { @<span class="ident">iter</span> [] [$(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">x</span>)<span class="kw-2">*</span>] }
    };

    <span class="comment">// inductive case</span>
    ( @<span class="ident">iter</span>
        [$((<span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>:<span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>:<span class="ident">ident</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>:<span class="ident">tt</span>))<span class="kw-2">*</span>]
        [<span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_head</span>:<span class="ident">tt</span> $(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_tail</span>:<span class="ident">tt</span>)<span class="kw-2">*</span>]
    ) =&gt; {
        <span class="macro">impl_binder_on_tuples!</span> { @<span class="ident">iter</span> [$((<span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, <span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>))<span class="op">*</span> <span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_head</span>] [$(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">next_tail</span>)<span class="kw-2">*</span>] }

        <span class="kw">impl</span><span class="op">&lt;</span>$( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>, )<span class="kw-2">*</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident">Binder</span> <span class="kw">for</span> ($( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>, )<span class="kw-2">*</span>)
        <span class="kw">where</span>
            $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI</span>: ~<span class="kw">const</span> <span class="ident">Binder</span>, )<span class="op">*</span>
        {
            <span class="kw">type</span> <span class="ident">Runtime</span> <span class="op">=</span> ( $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">BinderI::Runtime</span>, )<span class="op">*</span> );

            <span class="kw">fn</span> <span class="ident">register_dependency</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) {
                $( <span class="self">self</span>.<span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>.<span class="ident">register_dependency</span>(<span class="ident">ctx</span>); )<span class="op">*</span>
                <span class="kw">let</span> <span class="kw">_</span> <span class="op">=</span> <span class="ident">ctx</span>;
            }

            <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">clippy::unused_unit</span>)]</span>
            <span class="kw">fn</span> <span class="ident">into_runtime_binder</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Runtime</span> {
                ( $( <span class="self">self</span>.<span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>.<span class="ident">into_runtime_binder</span>(), )<span class="op">*</span> )
            }
        }

        <span class="kw">impl</span><span class="op">&lt;</span>$( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, )<span class="kw-2">*</span><span class="op">&gt;</span> <span class="ident">RuntimeBinder</span> <span class="kw">for</span> ($( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>, )<span class="kw-2">*</span>)
        <span class="kw">where</span>
            $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI</span>: <span class="ident">RuntimeBinder</span>, )<span class="op">*</span>
        {
            <span class="kw">type</span> <span class="ident">Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="op">=</span> ( $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>, )<span class="op">*</span> );

            <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">unused_unsafe</span>)]</span>
            <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">unused_variables</span>)]</span>
            <span class="attribute">#[<span class="ident">allow</span>(<span class="ident">clippy::unused_unit</span>)]</span>
            <span class="attribute">#[<span class="ident">inline</span>]</span>
            <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">materialize</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> {
                <span class="kw">unsafe</span> {
                    ( $( <span class="macro-nonterminal">$</span><span class="macro-nonterminal">RuntimeBinderI::materialize</span>(<span class="self">self</span>.<span class="macro-nonterminal">$</span><span class="macro-nonterminal">I</span>), )<span class="op">*</span> )
                }
            }
        }
    };

    <span class="comment">// base case</span>
    ( @<span class="ident">iter</span> [$(<span class="macro-nonterminal">$</span><span class="macro-nonterminal">_discard</span>:<span class="ident">tt</span>)<span class="kw-2">*</span>] [] ) =&gt; {}
}

<span class="macro">seq_macro::seq!</span>(<span class="ident">I</span> <span class="kw">in</span> <span class="number">0</span>..<span class="number">16</span> {
    <span class="macro">impl_binder_on_tuples!</span> { @<span class="ident">start</span> #( (<span class="ident">Binder</span>~<span class="ident">I</span>, <span class="ident">RuntimeBinder</span>~<span class="ident">I</span>, <span class="ident">I</span>) )<span class="op">*</span> }
});

<span class="kw">impl</span><span class="op">&lt;</span><span class="kw">const</span> <span class="ident">LEN</span>: <span class="ident">usize</span>, <span class="ident">Binder</span><span class="op">&gt;</span> <span class="kw">const</span> <span class="ident"><span class="self">self</span>::Binder</span> <span class="kw">for</span> [<span class="ident">Binder</span>; <span class="ident">LEN</span>]
<span class="kw">where</span>
    <span class="ident">Binder</span>: ~<span class="kw">const</span> <span class="ident"><span class="self">self</span>::Binder</span>,
{
    <span class="kw">type</span> <span class="ident">Runtime</span> <span class="op">=</span> [<span class="ident">Binder::Runtime</span>; <span class="ident">LEN</span>];

    <span class="kw">fn</span> <span class="ident">register_dependency</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">ctx</span>: <span class="kw-2">&amp;mut</span> <span class="ident">CfgBindCtx</span><span class="op">&lt;</span><span class="lifetime">&#39;_</span><span class="op">&gt;</span>) {
        <span class="comment">// `for` loops are unusable in `const fn` [ref:const_for]</span>
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">i</span> <span class="op">=</span> <span class="number">0</span>;
        <span class="kw">while</span> <span class="ident">i</span> <span class="op">&lt;</span> <span class="ident">LEN</span> {
            <span class="self">self</span>[<span class="ident">i</span>].<span class="ident">register_dependency</span>(<span class="ident">ctx</span>);
            <span class="ident">i</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
        }
    }

    <span class="kw">fn</span> <span class="ident">into_runtime_binder</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Runtime</span> {
        <span class="kw">unsafe</span> {
            <span class="comment">// `[T; N]::map` is unusable in `const fn` [ref:const_array_map]</span>
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">out</span> <span class="op">=</span> <span class="ident">MaybeUninit::uninit_array</span>();
            <span class="kw">let</span> <span class="ident">this</span> <span class="op">=</span> <span class="ident">MaybeUninit::new</span>(<span class="self">self</span>);
            <span class="comment">// `for` loops are unusable in `const fn` [ref:const_for]</span>
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">i</span> <span class="op">=</span> <span class="number">0</span>;
            <span class="kw">while</span> <span class="ident">i</span> <span class="op">&lt;</span> <span class="ident">LEN</span> {
                <span class="ident">out</span>[<span class="ident">i</span>] <span class="op">=</span> <span class="ident">MaybeUninit::new</span>(
                    <span class="ident">this</span>.<span class="ident">as_ptr</span>()
                        .<span class="ident">cast</span>::<span class="op">&lt;</span><span class="ident">Binder</span><span class="op">&gt;</span>()
                        .<span class="ident">wrapping_add</span>(<span class="ident">i</span>)
                        .<span class="ident">read</span>()
                        .<span class="ident">into_runtime_binder</span>(),
                );
                <span class="ident">i</span> <span class="op">+</span><span class="op">=</span> <span class="number">1</span>;
            }
            <span class="comment">// Safety: All elements of `out` are initialized</span>
            <span class="ident">MaybeUninit::array_assume_init</span>(<span class="ident">out</span>)
        }
    }
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="kw">const</span> <span class="ident">LEN</span>: <span class="ident">usize</span>, <span class="ident">RuntimeBinder</span><span class="op">&gt;</span> <span class="ident"><span class="self">self</span>::RuntimeBinder</span> <span class="kw">for</span> [<span class="ident">RuntimeBinder</span>; <span class="ident">LEN</span>]
<span class="kw">where</span>
    <span class="ident">RuntimeBinder</span>: <span class="ident"><span class="self">self</span>::RuntimeBinder</span>,
{
    <span class="kw">type</span> <span class="ident">Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> <span class="op">=</span> [<span class="ident">RuntimeBinder::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>; <span class="ident">LEN</span>];

    <span class="attribute">#[<span class="ident">inline</span>]</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">materialize</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span>(<span class="self">self</span>) -&gt; <span class="ident"><span class="self">Self</span>::Target</span><span class="op">&lt;</span><span class="lifetime">&#39;call</span><span class="op">&gt;</span> {
        <span class="comment">// Safety: Upheld by the caller</span>
        <span class="self">self</span>.<span class="ident">map</span>(<span class="op">|</span><span class="ident">x</span><span class="op">|</span> <span class="kw">unsafe</span> { <span class="ident">RuntimeBinder::materialize</span>(<span class="ident">x</span>) })
    }
}

<span class="comment">// ----------------------------------------------------------------------------</span>
</code></pre></div>
</section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="r3_core" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0-nightly (29e4a9ee0 2022-08-10)" ></div></body></html>